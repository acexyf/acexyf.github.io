(function(p,h){function d(i,l){return new Promise(function(o,a){i("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({target:l}))).then(e=>e.json()).then(({results:e,code:t,error:r})=>{if(t===401){throw r}if(e&&e.length>0){var n=e[0];o(n)}else{i("post","/classes/Counter",{target:l,time:0}).then(e=>e.json()).then((e,t)=>{if(t){throw t}o(e)}).catch(e=>{console.error("Failed to create",e);a(e)})}}).catch(e=>{console.error("LeanCloud Counter Error:",e);a(e)})})}function v(e,n){return new Promise(function(t,r){e("post","/batch",{requests:n}).then(e=>{e=e.json();if(e.error){throw e.error}t(e)}).catch(e=>{console.error("Failed to save visitor count",e);r(e)})})}function f(e){return{method:"PUT",path:`/1.1/classes/Counter/${e}`,body:{time:{__op:"Increment",amount:1}}}}function y(){var e="LeanCloud_UV_Flag";var t=localStorage.getItem(e);if(t){if((new Date).getTime()-parseInt(t,10)<=864e5){return false}}localStorage.setItem(e,(new Date).getTime().toString());return true}function t(e){var n=CONFIG.web_analytics.enable===true;var t=[];var o=[];var r=h.querySelector("#leancloud-site-pv-container");if(r){var a=d(e,"site-pv").then(e=>{n&&o.push(f(e.objectId));var t=h.querySelector("#leancloud-site-pv");if(t){t.innerText=e.time+1;if(r){r.style.display="inline"}}});t.push(a)}var i=h.querySelector("#leancloud-site-uv-container");if(i){var l=d(e,"site-uv").then(e=>{var t=y();t&&n&&o.push(f(e.objectId));var r=h.querySelector("#leancloud-site-uv");if(r){r.innerText=e.time+(t?1:0);if(i){i.style.display="inline"}}});t.push(l)}var s=h.querySelector("#leancloud-page-views-container");if(s){var c=decodeURI(p.location.pathname.replace(/(?<!\/)\/*(index.html)*$/,"/"));var u=d(e,c).then(e=>{n&&o.push(f(e.objectId));if(s){var t=h.querySelector("#leancloud-page-views");if(t){t.innerText=(e.time||0)+1;s.style.display="inline"}}});t.push(u)}if(n){Promise.all(t).then(()=>{o.length>0&&v(e,o)})}}var o=CONFIG.web_analytics.leancloud.app_id;var a=CONFIG.web_analytics.leancloud.app_key;var e=CONFIG.web_analytics.leancloud.server_url;function r(n){var e=(e,t,r)=>{return fetch(`${n}/1.1${t}`,{method:e,headers:{"X-LC-Id":o,"X-LC-Key":a,"Content-Type":"application/json"},body:JSON.stringify(r)})};t(e)}var n=o.slice(-9)!=="-MdYXbMMI"?e:`https://${o.slice(0,8).toLowerCase()}.api.lncldglobal.com`;if(n){r(n)}else{fetch("https://app-router.leancloud.cn/2/route?appId="+o).then(e=>e.json()).then(e=>{if(e.api_server){r("https://"+e.api_server)}})}})(window,document);