

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" href="/img/favicon.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="　　ElementUI作为当前最流行的Vue组件库，以其丰富多样的组件和可配置化程度高吸引着众多的开发者；今天我们就深入它的源码，看一下它内部众多组件究竟是如何来实现的，以便我们在今后的开发中写出通用化程度更高的组件，同时也加深对其组件用法的理解。">
  <meta name="author" content="Corner">
  <meta name="keywords" content="Corner">
  
  <title>跟着Element源码学组件化 - 谢小飞的博客</title>

  <link  rel="stylesheet" href="https://xieyufei.com/npm/bootstrap/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://xieyufei.com/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://xieyufei.com/npm/highlight.js@10.7.2/styles/vs2015.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://xieyufei.com/npm/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"xieyufei.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"466240fe55764d8ee20bd7f43c5e8b26","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":1260607518,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/title.js" ></script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="谢小飞的博客" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>谢小飞的博客</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-pen"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-friends"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="https://gallery.xieyufei.com/">
                <i class="iconfont icon-link-fill"></i>
                创意
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/bookshelf/">
                <i class="iconfont icon-books"></i>
                书架
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('//xieyufei.com/blog/bg_small.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="跟着Element源码学组件化">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-02-23 12:15" pubdate>
        2021年2月23日 中午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.6k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      113
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      
<style>
  .prevent_reptile{
    display: none;
  }
</style>
<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">跟着Element源码学组件化</h1>
            
            <div class="markdown-body">
              <p>　　ElementUI作为当前最流行的Vue组件库，以其丰富多样的组件和可配置化程度高吸引着众多的开发者；今天我们就深入它的源码，看一下它内部众多组件究竟是如何来实现的，以便我们在今后的开发中写出通用化程度更高的组件，同时也加深对其组件用法的理解。</p>
<span id="more"></span>

<p>　　老规矩，还是先来看一下官网的slogan：</p>
<blockquote>
<p>Element，一套为开发者、设计师和产品经理准备的基于<code>Vue 2.0</code>的桌面端组件库</p>
</blockquote>
<p>　　可以看出，Element的使用范围涵盖了大部分的研发人员；产品经理可以用来参考逻辑交互，设计师可以借鉴图标和组件设计，开发者可以使用它来布局页面。</p>
<h1 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h1><p>　　我们从github将整个项目<code>clone</code>下来后，来看一下有哪些目录文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">|-- .github <span class="hljs-comment"># 存放贡献指南以及issue、PR模板</span><br>|-- build <span class="hljs-comment"># 存放打包工具的配置文件</span><br>|-- examples <span class="hljs-comment"># 存放组件示例</span><br>|-- packages <span class="hljs-comment"># 存放组件源码，也是我们分析的主要目录</span><br>|-- src <span class="hljs-comment"># 存放入口文件以及各种工具文件</span><br>    |-- directives <span class="hljs-comment"># 滚轮优化和避免重复点击</span><br>    |-- locale <span class="hljs-comment"># 国际化功能</span><br>    |-- mixins <span class="hljs-comment"># 混入实例</span><br>    |-- transition <span class="hljs-comment"># 过度效果</span><br>    |-- utils <span class="hljs-comment"># 工具文件</span><br>|-- <span class="hljs-built_in">test</span> <span class="hljs-comment"># 存放单元测试文件</span><br>|-- types <span class="hljs-comment"># 存放typescript声明文件</span><br>|-- components.json <span class="hljs-comment"># 完整组件列表</span><br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>

<p>　　因此packages和src目录是我们需要关注的两个重要的目录；大致了解了目录结构后，下一个需要关注的就是<code>package.json</code>文件，这个文件包括了一些项目描述、项目依赖以及脚本命令等；有时候我们第一眼找不到项目的入口文件，就可以从这里来找。</p>
<p>　　首先是<code>&quot;main&quot;:&quot;lib/element-ui.common.js&quot;</code>，main字段定义了npm包的入口文件，我们在项目中<code>require(&quot;element-ui&quot;)</code>，其实就是引用了element-ui.common.js文件；然后我们来看一下有哪些脚本命令，这里引用了重要的几个命令：</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;scripts&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;build:file&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node build/bin/iconInit.js &amp; node build/bin/i18n.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;build:theme&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;gulp build --gulpfile packages/theme-chalk/gulpfile.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;build:utils&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cross-env BABEL_ENV=utils babel src --out-dir lib --ignore src/index.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;build:umd&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;node build/bin/build-locale.js&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;dist&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;webpack --config build/webpack.conf.js &amp;&amp; webpack --config build/webpack.common.js &amp;&amp; webpack --config build/webpack.component.js&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></div></td></tr></table></figure>

<p>　　可以看出来前面的几个<code>build</code>命令是用来构建一些工具、样式的，主要是<code>dist</code>命令，通过webpack进行打包，还进行了三次打包，我们分别来看下这三次打包分别是打包什么文件的；首先我们来看下前两个配置文件webpack.conf.js和webpack.common.js，这里只截取配置文件的部分代码：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//build/webpack.conf.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;production&#x27;</span>,<br>  <span class="hljs-attr">entry</span>: &#123;<br>    <span class="hljs-attr">app</span>: [<span class="hljs-string">&#x27;./src/index.js&#x27;</span>]<br>  &#125;,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">&#x27;./lib&#x27;</span>),<br>    <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;/dist/&#x27;</span>,<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;index.js&#x27;</span>,<br>    <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">&#x27;[id].js&#x27;</span>,<br>    <span class="hljs-attr">libraryTarget</span>: <span class="hljs-string">&#x27;umd&#x27;</span>,<br>    <span class="hljs-attr">libraryExport</span>: <span class="hljs-string">&#x27;default&#x27;</span>,<br>    <span class="hljs-attr">library</span>: <span class="hljs-string">&#x27;ELEMENT&#x27;</span>,<br>    <span class="hljs-attr">umdNamedDefine</span>: <span class="hljs-literal">true</span>,<br>    <span class="hljs-attr">globalObject</span>: <span class="hljs-string">&#x27;typeof self !== \&#x27;undefined\&#x27; ? self : this&#x27;</span><br>  &#125;,<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">minimizer</span>: [<br>      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>(&#123;<br>        <span class="hljs-attr">terserOptions</span>: &#123;<br>          <span class="hljs-attr">output</span>: &#123;<br>            <span class="hljs-attr">comments</span>: <span class="hljs-literal">false</span><br>          &#125;<br>        &#125;<br>      &#125;)<br>    ]<br>  &#125;,<br>&#125;<br><span class="hljs-comment">//build/webpack.common.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;production&#x27;</span>,<br>  <span class="hljs-attr">entry</span>: &#123;<br>    <span class="hljs-attr">app</span>: [<span class="hljs-string">&#x27;./src/index.js&#x27;</span>]<br>  &#125;,<br>  <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">&#x27;./lib&#x27;</span>),<br>    <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;/dist/&#x27;</span>,<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;element-ui.common.js&#x27;</span>,<br>    <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">&#x27;[id].js&#x27;</span>,<br>    <span class="hljs-attr">libraryExport</span>: <span class="hljs-string">&#x27;default&#x27;</span>,<br>    <span class="hljs-attr">library</span>: <span class="hljs-string">&#x27;ELEMENT&#x27;</span>,<br>    <span class="hljs-attr">libraryTarget</span>: <span class="hljs-string">&#x27;commonjs2&#x27;</span><br>  &#125;,<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">false</span><br>  &#125;,<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>　　发现两个文件的入口都是<code>src/index.js</code>，不同的是webpack.conf.js打包的是<code>umd规范</code>，而且通过<code>minimizer</code>进行了压缩；而webpack.common.js打包的是<code>commonjs规范</code>，并且没有进行压缩；通过两种规范来打包的主要原因也是因为Element安装方式的不同，umd规范主要针对CDN引入的方式，在页面上引入js和css：</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- 引入样式 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://unpkg.com/element-ui/lib/theme-chalk/index.css&quot;</span>&gt;</span><br><span class="hljs-comment">&lt;!-- 引入组件库 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://unpkg.com/element-ui/lib/index.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<p>　　而webpack.common.js打包出来的<code>element-ui.common.js</code>则是针对npm的引入方式：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ElementUI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;<br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>

<p>　　那么最后一个<code>build/webpack.component.js</code>也不难猜到了，是为了在npm引入时，只引入需要的部分组件，而不对整体进行打包：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Components</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;../components.json&#x27;</span>);<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">mode</span>: <span class="hljs-string">&#x27;production&#x27;</span>,<br>    <span class="hljs-attr">entry</span>: <span class="hljs-title class_">Components</span>,<br>    <span class="hljs-attr">output</span>: &#123;<br>    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(process.<span class="hljs-title function_">cwd</span>(), <span class="hljs-string">&#x27;./lib&#x27;</span>),<br>    <span class="hljs-attr">publicPath</span>: <span class="hljs-string">&#x27;/dist/&#x27;</span>,<br>    <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;[name].js&#x27;</span>,<br>    <span class="hljs-attr">chunkFilename</span>: <span class="hljs-string">&#x27;[id].js&#x27;</span>,<br>    <span class="hljs-attr">libraryTarget</span>: <span class="hljs-string">&#x27;commonjs2&#x27;</span><br>  &#125;,<br>  <span class="hljs-attr">optimization</span>: &#123;<br>    <span class="hljs-attr">minimize</span>: <span class="hljs-literal">false</span><br>  &#125;,<br>&#125;<br></code></pre></div></td></tr></table></figure>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>

<p>　　这里<code>components.json</code>就是每个组件所在的入口文件。</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<h1 id="入口文件"><a href="#入口文件" class="headerlink" title="入口文件"></a>入口文件</h1><p>　　我们在上面一节通过查看webpack的配置文件找到了入口文件<code>/src/index.js</code>，那么我们就来看一下Element在入口是如何来注册这么多组件的。</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//截取了部分组件</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Button</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../packages/button/index.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Input</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../packages/input/index.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">MessageBox</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../packages/message-box/index.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Loading</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../packages/loading/index.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">InfiniteScroll</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../packages/infinite-scroll/index.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Notification</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../packages/notification/index.js&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Message</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../packages/message/index.js&#x27;</span>;<br><br><span class="hljs-keyword">const</span> components = [<br>  <span class="hljs-title class_">Button</span>,<br>  <span class="hljs-title class_">Input</span><br>]<br><span class="hljs-keyword">const</span> install = <span class="hljs-keyword">function</span>(<span class="hljs-params">Vue, opts = &#123;&#125;</span>) &#123;<br>  components.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">component</span> =&gt;</span> &#123;<br>    <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">component</span>(component.<span class="hljs-property">name</span>, component);<br>  &#125;);<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">InfiniteScroll</span>);<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Loading</span>.<span class="hljs-property">directive</span>);<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$ELEMENT</span> = &#123;<br>    <span class="hljs-attr">size</span>: opts.<span class="hljs-property">size</span> || <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-attr">zIndex</span>: opts.<span class="hljs-property">zIndex</span> || <span class="hljs-number">2000</span><br>  &#125;;<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$loading</span> = <span class="hljs-title class_">Loading</span>.<span class="hljs-property">service</span>;<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$msgbox</span> = <span class="hljs-title class_">MessageBox</span>;<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$alert</span> = <span class="hljs-title class_">MessageBox</span>.<span class="hljs-property">alert</span>;<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$confirm</span> = <span class="hljs-title class_">MessageBox</span>.<span class="hljs-property">confirm</span>;<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$prompt</span> = <span class="hljs-title class_">MessageBox</span>.<span class="hljs-property">prompt</span>;<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$notify</span> = <span class="hljs-title class_">Notification</span>;<br>  <span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">$message</span> = <span class="hljs-title class_">Message</span>;<br>&#125;;<br><span class="hljs-comment">//浏览器环境自动调用注册组件</span><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">Vue</span>) &#123;<br>  <span class="hljs-title function_">install</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">Vue</span>);<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  install,<br>  <span class="hljs-title class_">Button</span>,<br>  <span class="hljs-title class_">Input</span>,<br>  <span class="hljs-title class_">MessageBox</span>,<br>  <span class="hljs-title class_">Notification</span><br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>　　这里Element暴露出去一个<code>install函数</code>，这是因为Element本身就是一个插件，我们在调用<code>Vue.use(ElementUI)</code>注册时，本质上就是调用这个install函数；那么<code>Vue.use</code>是如何注册插件的呢？</p>
<ol>
<li>Vue.use接收一个对象，这个对象必须具有install方法，Vue.use函数内部会调用参数的install方法。</li>
<li>如果插件没有被注册过，那么注册成功之后会给插件添加一个installed的属性值为true。Vue.use方法内部会检测插件的installed属性，从而避免重复注册插件。</li>
<li>插件的install方法将接收两个参数，第一个是参数是Vue，第二个参数是配置项options。</li>
<li>在install方法内部可以添加全局方法或者属性、全局指令、mixin混入、添加实例方法、使用Vue.component()注册组件等。</li>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
</ol>
<p>　　在Element的install函数中，我们发现从传入的<code>options</code>参数中取出size和zIndex，存到<code>Vue.prototype.$ELEMENT</code>全局配置中，这样在组件中我们就可以获取size和zIndex，根据size进行不同组件尺寸的展示。</p>
<p>　　在Element文档全局配置中，也指出了可以在引入Element时覆写全局配置：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Element</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui&#x27;</span>;<br><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Element</span>, &#123; <span class="hljs-attr">size</span>: <span class="hljs-string">&#x27;small&#x27;</span>, <span class="hljs-attr">zIndex</span>: <span class="hljs-number">3000</span> &#125;);<br></code></pre></div></td></tr></table></figure>


<h1 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h1><p>　　在上面install函数中，我们发现Element注册插件有三种方式，第一种是像Button和Input，在数组循环遍历，通过<code>Vue.component</code>中注册成全局组件，就可以在页面直接引用；第二种是InfiniteScroll和Loading，在全局注册指令，通过<code>v-infinite-scroll</code>和<code>v-loading</code>等指令式来调用；第三种是MessageBox、Notification和Message，在全局Vue.prototype添加了方法，可以通过函数进行调用。</p>
<h2 id="全局组件"><a href="#全局组件" class="headerlink" title="全局组件"></a>全局组件</h2><h3 id="Container和Header"><a href="#Container和Header" class="headerlink" title="Container和Header"></a>Container和Header</h3><p>　　首先我们从几个简单的布局容器组件开始，我们简单看一下demo回顾一下这几个组件的使用方法：</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-container</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-aside</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;200px&quot;</span>&gt;</span>Aside<span class="hljs-tag">&lt;/<span class="hljs-name">el-aside</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-container</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-header</span>&gt;</span>Header<span class="hljs-tag">&lt;/<span class="hljs-name">el-header</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-main</span>&gt;</span>Main<span class="hljs-tag">&lt;/<span class="hljs-name">el-main</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-footer</span>&gt;</span>Footer<span class="hljs-tag">&lt;/<span class="hljs-name">el-footer</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-container</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-container</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　我们先来看下el-header的源码，实现逻辑也很简单，通过slot插槽将元素进行渲染；（el-footer和el-aside也是同样的，这里不再展示了）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">//packages/header/src/main.vue<br>&lt;template&gt;<br>  &lt;header class=&quot;el-header&quot; :style=&quot;&#123; height &#125;&quot;&gt;<br>    &lt;slot&gt;&lt;/slot&gt;<br>  &lt;/header&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>  export default &#123;<br>    name: &#x27;ElHeader&#x27;,<br>    componentName: &#x27;ElHeader&#x27;,<br>    props: &#123;<br>      height: &#123;<br>        type: String,<br>        default: &#x27;60px&#x27;<br>      &#125;<br>    &#125;<br>  &#125;;<br>&lt;/script&gt;<br></code></pre></div></td></tr></table></figure>

<p>　　这里传参的props和文档中给出也是一致的，el-header、el-footer和el-aside三个组件都是类似，都传width或者height等一些宽高的字符串数值。</p>
<p>　　我们重点来看下el-container的代码，接收一个参数direction，可选值horizontal/vertical，不过它的默认值比较特殊，文档中是这么说的：</p>
<blockquote>
<p>子元素中有<code>el-header</code>或<code>el-footer</code>时为<code>vertical</code>，否则为<code>horizontal</code></p>
</blockquote>
<p>　　了解了它的传参逻辑，我们来看下源码是如何来实现的：</p>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">//packages/container/src/main.vue<br>&lt;template&gt;<br>  &lt;section class=&quot;el-container&quot; :class=&quot;&#123; &#x27;is-vertical&#x27;: isVertical &#125;&quot;&gt;<br>    &lt;slot&gt;&lt;/slot&gt;<br>  &lt;/section&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>export default &#123;<br>  name: &quot;ElContainer&quot;,<br>  componentName: &quot;ElContainer&quot;,<br>  props: &#123;<br>    direction: String,<br>  &#125;,<br>  computed: &#123;<br>    isVertical() &#123;<br>      if (this.direction === &quot;vertical&quot;) &#123;<br>        return true;<br>      &#125; else if (this.direction === &quot;horizontal&quot;) &#123;<br>        return false;<br>      &#125;<br>      return this.$slots &amp;&amp; this.$slots.default<br>        ? this.$slots.default.some((vnode) =&gt; &#123;<br>            const tag = vnode.componentOptions &amp;&amp; vnode.componentOptions.tag;<br>            return tag === &quot;el-header&quot; || tag === &quot;el-footer&quot;;<br>          &#125;)<br>        : false;<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br></code></pre></div></td></tr></table></figure>

<p>　　代码中比较难理解的是isVertical中的逻辑判断，我们一段一段来看；<code>this.$slots</code>是用来获取组件中所有的插槽组件，和<code>this.$refs</code>有点像，都是对象，用来存放多个插槽对象；而<code>this.$slots.default</code>是获取默认的那个插槽，它是一个数组，存放是插槽中的节点；然后some函数中的判断就很好理解了，用来判断数组中的vnode节点的是否有el-header或者el-footer两个标签，有的话就返回true，就会渲染is-vertical类名。</p>
<h3 id="Row和Col"><a href="#Row和Col" class="headerlink" title="Row和Col"></a>Row和Col</h3><p>　　我们再来看两个布局组件Row和Col，用于创建栅格布局，我们还是简单的看一下这两个组件的用法：</p>
<figure class="highlight html"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-row</span> <span class="hljs-attr">:gutter</span>=<span class="hljs-string">&quot;20&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grid-content&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-col</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grid-content&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-col</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grid-conten&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-col</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">el-col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">&quot;6&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;grid-content&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">el-col</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-row</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>　　看用法这两个组件也是在页面通过插槽的方式渲染页面，不过当我们来看源码会发现它的插槽和上面组件的插槽用法还不一样：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//packages/row/src/row.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;ElRow&#x27;</span>,<br>  <span class="hljs-attr">props</span>: &#123;<br>    <span class="hljs-attr">tag</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>      <span class="hljs-attr">default</span>: <span class="hljs-string">&#x27;div&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">gutter</span>: <span class="hljs-title class_">Number</span>,<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>    <span class="hljs-attr">justify</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>      <span class="hljs-attr">default</span>: <span class="hljs-string">&#x27;start&#x27;</span><br>    &#125;,<br>    <span class="hljs-attr">align</span>: &#123;<br>      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,<br>      <span class="hljs-attr">default</span>: <span class="hljs-string">&#x27;top&#x27;</span><br>    &#125;<br>  &#125;,<br>  <span class="hljs-attr">computed</span>: &#123;<br>    <span class="hljs-title function_">style</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">const</span> ret = &#123;&#125;;<br>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">gutter</span>) &#123;<br>        ret.<span class="hljs-property">marginLeft</span> = <span class="hljs-string">`-<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.gutter / <span class="hljs-number">2</span>&#125;</span>px`</span>;<br>        ret.<span class="hljs-property">marginRight</span> = ret.<span class="hljs-property">marginLeft</span>;<br>      &#125;<br>      <span class="hljs-keyword">return</span> ret;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params">h</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tag</span>, &#123;<br>      <span class="hljs-attr">class</span>: [<br>        <span class="hljs-string">&#x27;el-row&#x27;</span>,<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">justify</span> !== <span class="hljs-string">&#x27;start&#x27;</span> ? <span class="hljs-string">`is-justify-<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.justify&#125;</span>`</span> : <span class="hljs-string">&#x27;&#x27;</span>,<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">align</span> !== <span class="hljs-string">&#x27;top&#x27;</span> ? <span class="hljs-string">`is-align-<span class="hljs-subst">$&#123;<span class="hljs-variable language_">this</span>.align&#125;</span>`</span> : <span class="hljs-string">&#x27;&#x27;</span>,<br>        &#123; <span class="hljs-string">&#x27;el-row--flex&#x27;</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;flex&#x27;</span> &#125;<br>      ],<br>      <span class="hljs-attr">style</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">style</span><br>    &#125;, <span class="hljs-variable language_">this</span>.<span class="hljs-property">$slots</span>.<span class="hljs-property">default</span>);<br>  &#125;<br>&#125;;<br></code></pre></div></td></tr></table></figure>

<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　我们发现el-row插件没有模板template渲染，而是通过render渲染函数来渲染页面的；但是这里为什么需要用到渲染函数呢？这里和el-row的参数有关，在传参列表中我们可以看到参数中有一个tag自定义元素标签，也就是定义最外层的标签类型；如果通过模板渲染的话肯定需要多个if判断，比较繁琐，但是通过渲染函数，就直接渲染标签了；渲染函数有关使用方法可以查看<a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/guide/render-function.html">官网文档</a>。</p>
<p>　　Col组件和Row类似，都是通过render函数进行渲染，不过Col组件获取父级组件Row的参数方式值的我们来学习一下，这里贴上部分代码：</p>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//packages/col/src/col.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;ElCol&quot;</span>,<br>  <span class="hljs-attr">computed</span>: &#123;<br>    <span class="hljs-title function_">gutter</span>(<span class="hljs-params"></span>) &#123;<br>      <span class="hljs-keyword">let</span> parent = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$parent</span>;<br>      <span class="hljs-keyword">while</span> (parent &amp;&amp; parent.<span class="hljs-property">$options</span>.<span class="hljs-property">componentName</span> !== <span class="hljs-string">&quot;ElRow&quot;</span>) &#123;<br>        parent = parent.<span class="hljs-property">$parent</span>;<br>      &#125;<br>      <span class="hljs-keyword">return</span> parent ? parent.<span class="hljs-property">gutter</span> : <span class="hljs-number">0</span>;<br>    &#125;,<br>  &#125;,<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params">h</span>) &#123;<br>    <span class="hljs-keyword">let</span> classList = [];<br>    <span class="hljs-keyword">let</span> style = &#123;&#125;;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">gutter</span>) &#123;<br>      style.<span class="hljs-property">paddingLeft</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">gutter</span> / <span class="hljs-number">2</span> + <span class="hljs-string">&quot;px&quot;</span>;<br>      style.<span class="hljs-property">paddingRight</span> = style.<span class="hljs-property">paddingLeft</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tag</span>, &#123;<br>        <span class="hljs-attr">class</span>: [<span class="hljs-string">&quot;el-col&quot;</span>, classList],<br>        style,<br>      &#125;,<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$slots</span>.<span class="hljs-property">default</span><br>    );<br>  &#125;,<br>&#125;;<br></code></pre></div></td></tr></table></figure>

<p>　　由于Row组件传入的gutter表示栅格间隔，因此Rol组件也需设置一定的padding，但是怎么能从父组件获取参数呢？Col通过一个<code>while循环</code>，不断向上获取父组件并且判断组件名称。</p>
<h3 id="Form和Form-Item"><a href="#Form和Form-Item" class="headerlink" title="Form和Form-Item"></a>Form和Form-Item</h3><p>　　看完布局组件，我们来看一下表单组件，表单最顶层的是Form和Form-Item组件，我们可以通过向Form传入参数<code>rules</code>来校验表单中的Input输入框或者其他组件的值，首先来看下Form的源码，由于篇幅问题这里只贴出部分源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">//packages/form/src/form.vue<br>&lt;template&gt;<br>  &lt;form class=&quot;el-form&quot; :class=&quot;[<br>    labelPosition ? &#x27;el-form--label-&#x27; + labelPosition : &#x27;&#x27;,<br>    &#123; &#x27;el-form--inline&#x27;: inline &#125;<br>  ]&quot;&gt;<br>    &lt;slot&gt;&lt;/slot&gt;<br>  &lt;/form&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>  export default &#123;<br>    name: &#x27;ElForm&#x27;,<br>    provide() &#123;<br>      return &#123;<br>        elForm: this<br>      &#125;;<br>    &#125;,<br>    watch: &#123;<br>      rules() &#123;<br>        // remove then add event listeners on form-item after form rules change<br>        this.fields.forEach(field =&gt; &#123;<br>          field.removeValidateEvents();<br>          field.addValidateEvents();<br>        &#125;);<br><br>        if (this.validateOnRuleChange) &#123;<br>          this.validate(() =&gt; &#123;&#125;);<br>        &#125;<br>      &#125;<br>    &#125;,<br>    data() &#123;<br>      return &#123;<br>        fields: [],<br>        potentialLabelWidthArr: [] // use this array to calculate auto width<br>      &#125;;<br>    &#125;,<br>    created() &#123;<br>      this.$on(&#x27;el.form.addField&#x27;, (field) =&gt; &#123;<br>        if (field) &#123;<br>          this.fields.push(field);<br>        &#125;<br>      &#125;);<br>      /* istanbul ignore next */<br>      this.$on(&#x27;el.form.removeField&#x27;, (field) =&gt; &#123;<br>        if (field.prop) &#123;<br>          this.fields.splice(this.fields.indexOf(field), 1);<br>        &#125;<br>      &#125;);<br>    &#125;,<br>    methods: &#123;<br>      validate(callback) &#123;<br>        let promise;<br>        if (typeof callback !== &#x27;function&#x27; &amp;&amp; window.Promise) &#123;<br>          promise = new window.Promise((resolve, reject) =&gt; &#123;<br>            callback = function(valid) &#123;<br>              valid ? resolve(valid) : reject(valid);<br>            &#125;;<br>          &#125;);<br>        &#125;<br>        let valid = true;<br>        let count = 0;<br>        let invalidFields = &#123;&#125;;<br>        this.fields.forEach(field =&gt; &#123;<br>          field.validate(&#x27;&#x27;, (message, field) =&gt; &#123;<br>            if (message) &#123;<br>              valid = false;<br>            &#125;<br>            invalidFields = objectAssign(&#123;&#125;, invalidFields, field);<br>            if (typeof callback === &#x27;function&#x27; &amp;&amp; ++count === this.fields.length) &#123;<br>              callback(valid, invalidFields);<br>            &#125;<br>          &#125;);<br>        &#125;);<br>        if (promise) &#123; return promise; &#125;<br>      &#125;,<br>    &#125;<br>  &#125;;<br>&lt;/script&gt;<br></code></pre></div></td></tr></table></figure>

<p>　　我们看到Form的页面结构非常简单，只有一个form标签，而且props也只用到了<code>labelPosition</code>和<code>inline</code>两个，其他的属性会在Form-Item中用到；Form中还用到了一个<code>provide函数</code>，在<a href="https://xieyufei.com/2020/03/20/Vue-Communicate.html">Vue中组件通信方式</a>中，我们介绍过<code>provide/inject</code>，主要是用来跨多层组件通信的，在后面组件的介绍中，我们会取出来用到。</p>
<p>　　重点我们看下常用的表单校验函数<code>validate</code>是如何来实现的；在created中，我们看到在注册了两个事件：<code>addField</code>和<code>removeField</code>，这是用来在所有的子组件Form-Item初始化时调用，进行一个收集存储，存到<code>fields数组</code>中，那么这里为什么不用$children呢？因为页面结构的不确定，Form下一级子组件不一定就是Form-Item，如果进行循环的话比较费时费力，而且对子组件管理操作也比较频繁，因此通过事件的方式；收集所有的Form-Item后，我们就可以对每个表单元素遍历并且校验。</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　接着就是Form-Item，来看下它的源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">//packages/form/src/form-item.vue<br>&lt;template&gt;<br>  &lt;div class=&quot;el-form-item&quot; :class=&quot;[&#123;<br>      &#x27;el-form-item--feedback&#x27;: elForm &amp;&amp; elForm.statusIcon,<br>      &#x27;is-error&#x27;: validateState === &#x27;error&#x27;,<br>      &#x27;is-validating&#x27;: validateState === &#x27;validating&#x27;,<br>      &#x27;is-success&#x27;: validateState === &#x27;success&#x27;,<br>      &#x27;is-required&#x27;: isRequired || required,<br>      &#x27;is-no-asterisk&#x27;: elForm &amp;&amp; elForm.hideRequiredAsterisk<br>    &#125;,<br>    sizeClass ? &#x27;el-form-item--&#x27; + sizeClass : &#x27;&#x27;<br>  ]&quot;&gt;<br>    &lt;label-wrap<br>      :is-auto-width=&quot;labelStyle &amp;&amp; labelStyle.width === &#x27;auto&#x27;&quot;<br>      :update-all=&quot;form.labelWidth === &#x27;auto&#x27;&quot;&gt;<br>      &lt;label :for=&quot;labelFor&quot; class=&quot;el-form-item__label&quot; :style=&quot;labelStyle&quot; v-if=&quot;label || $slots.label&quot;&gt;<br>        &lt;slot name=&quot;label&quot;&gt;&#123;&#123;label + form.labelSuffix&#125;&#125;&lt;/slot&gt;<br>      &lt;/label&gt;<br>    &lt;/label-wrap&gt;<br>    &lt;div class=&quot;el-form-item__content&quot; :style=&quot;contentStyle&quot;&gt;<br>      &lt;slot&gt;&lt;/slot&gt;<br>      &lt;transition name=&quot;el-zoom-in-top&quot;&gt;<br>        &lt;slot<br>          v-if=&quot;validateState === &#x27;error&#x27; &amp;&amp; showMessage &amp;&amp; form.showMessage&quot;<br>          name=&quot;error&quot;<br>          :error=&quot;validateMessage&quot;&gt;<br>          &lt;div<br>            class=&quot;el-form-item__error&quot;<br>            :class=&quot;&#123;<br>              &#x27;el-form-item__error--inline&#x27;: typeof inlineMessage === &#x27;boolean&#x27;<br>                ? inlineMessage<br>                : (elForm &amp;&amp; elForm.inlineMessage || false)<br>            &#125;&quot;<br>          &gt;<br>            &#123;&#123;validateMessage&#125;&#125;<br>          &lt;/div&gt;<br>        &lt;/slot&gt;<br>      &lt;/transition&gt;<br>    &lt;/div&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>  import AsyncValidator from &#x27;async-validator&#x27;;<br>  import emitter from &#x27;element-ui/src/mixins/emitter&#x27;;<br>  import objectAssign from &#x27;element-ui/src/utils/merge&#x27;;<br>  import &#123; noop, getPropByPath &#125; from &#x27;element-ui/src/utils/util&#x27;;<br>  export default &#123;<br>    name: &#x27;ElFormItem&#x27;,<br>    componentName: &#x27;ElFormItem&#x27;,<br>    mixins: [emitter],<br>    provide() &#123;<br>      return &#123;<br>        elFormItem: this<br>      &#125;;<br>    &#125;,<br>    inject: [&#x27;elForm&#x27;],<br>    computed: &#123;<br>      fieldValue() &#123;<br>        const model = this.form.model;<br>        if (!model || !this.prop) &#123; return; &#125;<br>        let path = this.prop;<br>        if (path.indexOf(&#x27;:&#x27;) !== -1) &#123;<br>          path = path.replace(/:/, &#x27;.&#x27;);<br>        &#125;<br>        return getPropByPath(model, path, true).v;<br>      &#125;,<br>      _formSize() &#123;<br>        return this.elForm.size;<br>      &#125;,<br>      elFormItemSize() &#123;<br>        return this.size || this._formSize;<br>      &#125;,<br>      sizeClass() &#123;<br>        return this.elFormItemSize || (this.$ELEMENT || &#123;&#125;).size;<br>      &#125;<br>    &#125;,<br>    data() &#123;<br>      return &#123;<br>        validateState: &#x27;&#x27;,<br>        validateMessage: &#x27;&#x27;,<br>        validateDisabled: false,<br>        validator: &#123;&#125;,<br>        isNested: false,<br>        computedLabelWidth: &#x27;&#x27;<br>      &#125;;<br>    &#125;,<br>    methods: &#123;<br>      validate(trigger, callback = noop) &#123;<br>        this.validateDisabled = false;<br>        const rules = this.getFilteredRule(trigger);<br>        if ((!rules || rules.length === 0) &amp;&amp; this.required === undefined) &#123;<br>          callback();<br>          return true;<br>        &#125;<br>        this.validateState = &#x27;validating&#x27;;<br>        const descriptor = &#123;&#125;;<br>        if (rules &amp;&amp; rules.length &gt; 0) &#123;<br>          rules.forEach(rule =&gt; &#123;<br>            delete rule.trigger;<br>          &#125;);<br>        &#125;<br>        descriptor[this.prop] = rules;<br>        const validator = new AsyncValidator(descriptor);<br>        const model = &#123;&#125;;<br><br>        model[this.prop] = this.fieldValue;<br><br>        validator.validate(model, &#123; firstFields: true &#125;, (errors, invalidFields) =&gt; &#123;<br>          this.validateState = !errors ? &#x27;success&#x27; : &#x27;error&#x27;;<br>          this.validateMessage = errors ? errors[0].message : &#x27;&#x27;;<br><br>          callback(this.validateMessage, invalidFields);<br>          this.elForm &amp;&amp; this.elForm.$emit(&#x27;validate&#x27;, this.prop, !errors, this.validateMessage || null);<br>        &#125;);<br>      &#125;,<br>      getRules() &#123;<br>        let formRules = this.form.rules;<br>        const selfRules = this.rules;<br>        const requiredRule = this.required !== undefined ? &#123; required: !!this.required &#125; : [];<br><br>        const prop = getPropByPath(formRules, this.prop || &#x27;&#x27;);<br>        formRules = formRules ? (prop.o[this.prop || &#x27;&#x27;] || prop.v) : [];<br><br>        return [].concat(selfRules || formRules || []).concat(requiredRule);<br>      &#125;,<br>      onFieldBlur() &#123;<br>        this.validate(&#x27;blur&#x27;);<br>      &#125;,<br>      onFieldChange() &#123;<br>        if (this.validateDisabled) &#123;<br>          this.validateDisabled = false;<br>          return;<br>        &#125;<br>        this.validate(&#x27;change&#x27;);<br>      &#125;,<br>      addValidateEvents() &#123;<br>        const rules = this.getRules();<br>        if (rules.length || this.required !== undefined) &#123;<br>          this.$on(&#x27;el.form.blur&#x27;, this.onFieldBlur);<br>          this.$on(&#x27;el.form.change&#x27;, this.onFieldChange);<br>        &#125;<br>      &#125;,<br>    &#125;,<br>    mounted() &#123;<br>      if (this.prop) &#123;<br>        this.dispatch(&#x27;ElForm&#x27;, &#x27;el.form.addField&#x27;, [this]);<br>        this.addValidateEvents();<br>      &#125;<br>    &#125;,<br>    beforeDestroy() &#123;<br>      this.dispatch(&#x27;ElForm&#x27;, &#x27;el.form.removeField&#x27;, [this]);<br>    &#125;<br>  &#125;;<br>&lt;/script&gt;<br></code></pre></div></td></tr></table></figure>


<p>　　我们看到这里还是用了<code>provide/inject</code>来处理跨组件的数据通信，将Form引入，用到了Form的几个props值来渲染类名，同时将本身inject向下传递。在<code>sizeClass</code>中我们看到获取size也是向上渐进获取的一个过程，首先是Form-Item本身的size，然后是Form的size，最后才是我们挂载在全局<code>$ELEMENT</code>的size，我们去查看其他组件例如Input、Button、Radio，都是通过这种方式来渲染size。</p>
<p>　　在Form-Item生命周期函数中我们也看到了，通过触发了Form的addField和removeField来进行表单的收集，不过通过一个<code>dispatch</code>函数，这个函数既不是vue官网中的，在<code>methods</code>中也没有进行定义，那么它是如何来触发的呢？我们仔细看代码，会发现一个<code>mixins:[emitter]</code>数组，原来Form-Item是通过mixins将一些公共的函数提取出来，那么我们来看一下emitter里面是做了哪些操作：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">broadcast</span>(<span class="hljs-params">componentName, eventName, params</span>) &#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$children</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">var</span> name = child.<span class="hljs-property">$options</span>.<span class="hljs-property">componentName</span>;<br>    <span class="hljs-keyword">if</span> (name === componentName) &#123;<br>      child.<span class="hljs-property">$emit</span>.<span class="hljs-title function_">apply</span>(child, [eventName].<span class="hljs-title function_">concat</span>(params));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      broadcast.<span class="hljs-title function_">apply</span>(child, [componentName, eventName].<span class="hljs-title function_">concat</span>([params]));<br>    &#125;<br>  &#125;);<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">methods</span>: &#123;<br>    <span class="hljs-title function_">dispatch</span>(<span class="hljs-params">componentName, eventName, params</span>) &#123;<br>      <span class="hljs-keyword">var</span> parent = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$parent</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">$root</span>;<br>      <span class="hljs-keyword">var</span> name = parent.<span class="hljs-property">$options</span>.<span class="hljs-property">componentName</span>;<br>      <span class="hljs-keyword">while</span> (parent &amp;&amp; (!name || name !== componentName)) &#123;<br>        parent = parent.<span class="hljs-property">$parent</span>;<br>        <span class="hljs-keyword">if</span> (parent) &#123;<br>          name = parent.<span class="hljs-property">$options</span>.<span class="hljs-property">componentName</span>;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">if</span> (parent) &#123;<br>        parent.<span class="hljs-property">$emit</span>.<span class="hljs-title function_">apply</span>(parent, [eventName].<span class="hljs-title function_">concat</span>(params));<br>      &#125;<br>    &#125;,<br>    <span class="hljs-title function_">broadcast</span>(<span class="hljs-params">componentName, eventName, params</span>) &#123;<br>      broadcast.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, componentName, eventName, params);<br>    &#125;<br>  &#125;<br>&#125;;<br></code></pre></div></td></tr></table></figure>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>

<p>　　我们看到<code>dispatch</code>是用来向父组件派发事件，也是通过while向上遍历循环，而<code>broadcast</code>是向子组件广播事件的。</p>
<h3 id="Button和Button-Group"><a href="#Button和Button-Group" class="headerlink" title="Button和Button-Group"></a>Button和Button-Group</h3><p>　　Button是我们常用的组件，我们来看下它的源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">//packages/button/src/button.vue<br>&lt;template&gt;<br>  &lt;button<br>    class=&quot;el-button&quot;<br>    @click=&quot;handleClick&quot;<br>    :disabled=&quot;buttonDisabled || loading&quot;<br>    :autofocus=&quot;autofocus&quot;<br>    :type=&quot;nativeType&quot;<br>    :class=&quot;[<br>      type ? &#x27;el-button--&#x27; + type : &#x27;&#x27;,<br>      buttonSize ? &#x27;el-button--&#x27; + buttonSize : &#x27;&#x27;,<br>      &#123;<br>        &#x27;is-disabled&#x27;: buttonDisabled,<br>        &#x27;is-loading&#x27;: loading,<br>        &#x27;is-plain&#x27;: plain,<br>        &#x27;is-round&#x27;: round,<br>        &#x27;is-circle&#x27;: circle<br>      &#125;<br>    ]&quot;<br>  &gt;<br>    &lt;i class=&quot;el-icon-loading&quot; v-if=&quot;loading&quot;&gt;&lt;/i&gt;<br>    &lt;i :class=&quot;icon&quot; v-if=&quot;icon &amp;&amp; !loading&quot;&gt;&lt;/i&gt;<br>    &lt;span v-if=&quot;$slots.default&quot;&gt;&lt;slot&gt;&lt;/slot&gt;&lt;/span&gt;<br>  &lt;/button&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>  export default &#123;<br>    name: &#x27;ElButton&#x27;,<br>    inject: &#123;<br>      elForm: &#123;<br>        default: &#x27;&#x27;<br>      &#125;,<br>      elFormItem: &#123;<br>        default: &#x27;&#x27;<br>      &#125;<br>    &#125;,<br>    props: &#123;<br>      type: &#123;<br>        type: String,<br>        default: &#x27;default&#x27;<br>      &#125;,<br>      size: String,<br>      icon: &#123;<br>        type: String,<br>        default: &#x27;&#x27;<br>      &#125;,<br>      nativeType: &#123;<br>        type: String,<br>        default: &#x27;button&#x27;<br>      &#125;,<br>      loading: Boolean,<br>      disabled: Boolean,<br>      plain: Boolean,<br>      autofocus: Boolean,<br>      round: Boolean,<br>      circle: Boolean<br>    &#125;,<br>    computed: &#123;<br>      _elFormItemSize() &#123;<br>        return (this.elFormItem || &#123;&#125;).elFormItemSize;<br>      &#125;,<br>      buttonSize() &#123;<br>        return this.size || this._elFormItemSize || (this.$ELEMENT || &#123;&#125;).size;<br>      &#125;,<br>      buttonDisabled() &#123;<br>        return this.disabled || (this.elForm || &#123;&#125;).disabled;<br>      &#125;<br>    &#125;,<br>    methods: &#123;<br>      handleClick(evt) &#123;<br>        this.$emit(&#x27;click&#x27;, evt);<br>      &#125;<br>    &#125;<br>  &#125;;<br>&lt;/script&gt;<br></code></pre></div></td></tr></table></figure>


<p>　　我们看到Button逻辑相较于上面的组件很简单，通过computed计算了buttonSize和buttonDisabled进行类名渲染，同时依赖了注入的elForm和elFormItem中的数据；在点击时触发了click事件；我们还可以通过Button-Group将多个按钮进行嵌套，来看下它的源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">//packages/button/src/button-group.vue<br>&lt;template&gt;<br>  &lt;div class=&quot;el-button-group&quot;&gt;<br>    &lt;slot&gt;&lt;/slot&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>  export default &#123;<br>    name: &#x27;ElButtonGroup&#x27;<br>  &#125;;<br>&lt;/script&gt;<br></code></pre></div></td></tr></table></figure>

<p>　　它的代码更简单，只用了一个slot嵌套了所有的Button。</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<h2 id="指令式组件"><a href="#指令式组件" class="headerlink" title="指令式组件"></a>指令式组件</h2><p>　　指令式组件通过<code>Vue.directive(name, opt)</code>来注册，name就是我们要注册的指令名称，而opt是一个对象，包含了5个钩子函数，我们可以根据需要只写其中的几个函数：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">directive</span>(<span class="hljs-string">&quot;demo&quot;</span>, &#123;<br>  <span class="hljs-comment">//只调用一次，指令第一次绑定到元素时调用</span><br>  <span class="hljs-attr">bind</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">el,binding,vnode</span>)&#123; &#125;,<br>  <span class="hljs-comment">//被绑定元素插入父节点时调用</span><br>  <span class="hljs-attr">inserted</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">el,binding,vnode</span>)&#123; &#125;,<br>  <span class="hljs-comment">//所在组件的 VNode 更新时调用</span><br>  <span class="hljs-attr">update</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">el,binding,vnode</span>)&#123; &#125;,<br>  <span class="hljs-comment">//指令所在组件的 VNode 及其子 VNode 全部更新后调用</span><br>  <span class="hljs-attr">componentUpdated</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">el,binding,vnode</span>)&#123; &#125;,<br>  <span class="hljs-comment">//只调用一次，指令与元素解绑时调用。</span><br>  <span class="hljs-attr">unbind</span>:<span class="hljs-keyword">function</span>(<span class="hljs-params">el,binding,vnode</span>)&#123; &#125;,<br>&#125;)<br></code></pre></div></td></tr></table></figure>

<p>　　每个钩子函数都有三个回调参数，<code>el</code>表示了指令所绑定的元素，可以用来直接DOM操作；而<code>binding</code>就是我们的绑定信息了，它是一个对象，包含以下属性：</p>
<ul>
<li>name：指令名，不包括<code>v-</code>前缀。</li>
<li>value：指令的绑定值，比如v-demo=”num”，邦定值为num值，2。</li>
<li>expression：字符串形式的指令表达式，比如v-demo=”num”，表达式为num。</li>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<li>modifiers：一个包含修饰符的对象，比如v-demo.foo.bar修饰符对象为 { foo: true, bar: true }</li>
<li>rawName：完整的指令修饰</li>
</ul>
<h3 id="InfiniteScroll"><a href="#InfiniteScroll" class="headerlink" title="InfiniteScroll"></a>InfiniteScroll</h3><p>　　InfiniteScroll无限滚动组件的用法也很简单，在我们想要滚动加载的列表上加上<code>v-infinite-scroll</code>，赋值自定义加载的函数，在列表滚动到底部时就会自动触发函数，我们来看一个官方的Demo：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;ul class=&quot;infinite-list&quot; v-infinite-scroll=&quot;load&quot; style=&quot;overflow:auto&quot;&gt;<br>    &lt;li v-for=&quot;i in count&quot; :key=&quot;i&quot; class=&quot;infinite-list-item&quot;&gt;&#123;&#123; i &#125;&#125;&lt;/li&gt;<br>  &lt;/ul&gt;<br>&lt;/template&gt;<br>&lt;script&gt;<br>export default &#123;<br>  data() &#123;<br>    return &#123;<br>      count: 0,<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    load() &#123;<br>      this.count += 2;<br>    &#125;,<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br></code></pre></div></td></tr></table></figure>

<p>　　在ul滚动到最底部时，触发load函数，加载更多的数据；因此这个指令的实现原理也很简单，就是监听容器滚动，滚动到底部时进行函数调用，我们来看下具体是怎么来实现的：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> throttle <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;throttle-debounce/debounce&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123;<br>  getScrollContainer<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui/src/utils/dom&#x27;</span>;<br><br><span class="hljs-keyword">const</span> attributes = &#123;<br>  <span class="hljs-attr">delay</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,<br>    <span class="hljs-attr">default</span>: <span class="hljs-number">200</span><br>  &#125;,<br>  <span class="hljs-attr">distance</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Number</span>,<br>    <span class="hljs-attr">default</span>: <span class="hljs-number">0</span><br>  &#125;,<br>  <span class="hljs-attr">disabled</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,<br>    <span class="hljs-attr">default</span>: <span class="hljs-literal">false</span><br>  &#125;,<br>  <span class="hljs-attr">immediate</span>: &#123;<br>    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Boolean</span>,<br>    <span class="hljs-attr">default</span>: <span class="hljs-literal">true</span><br>  &#125;<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getScrollOptions</span> = (<span class="hljs-params">el, vm</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isHtmlElement</span>(el)) <span class="hljs-keyword">return</span> &#123;&#125;;<br>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">entries</span>(attributes).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">map, [key, option]</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> &#123; type, <span class="hljs-attr">default</span>: defaultValue &#125; = option;<br>    <span class="hljs-keyword">let</span> value = el.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">`infinite-scroll-<span class="hljs-subst">$&#123;key&#125;</span>`</span>);<br>    value = <span class="hljs-title function_">isUndefined</span>(vm[value]) ? value : vm[value];<br>    <span class="hljs-keyword">switch</span> (type) &#123;<br>      <span class="hljs-keyword">case</span> <span class="hljs-title class_">Number</span>:<br>        value = <span class="hljs-title class_">Number</span>(value);<br>        value = <span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(value) ? defaultValue : value;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-title class_">Boolean</span>:<br>        value = <span class="hljs-title function_">isDefined</span>(value) ? value === <span class="hljs-string">&#x27;false&#x27;</span> ? <span class="hljs-literal">false</span> : <span class="hljs-title class_">Boolean</span>(value) : defaultValue;<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-attr">default</span>:<br>        value = <span class="hljs-title function_">type</span>(value);<br>    &#125;<br>    map[key] = value;<br>    <span class="hljs-keyword">return</span> map;<br>  &#125;, &#123;&#125;);<br>&#125;;<br><br><span class="hljs-keyword">const</span> handleScroll = <span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) &#123;<br>  <span class="hljs-keyword">const</span> &#123; el, vm, container, observer &#125; = <span class="hljs-variable language_">this</span>[scope];<br>  <span class="hljs-keyword">const</span> &#123; distance, disabled &#125; = <span class="hljs-title function_">getScrollOptions</span>(el, vm);<br>  <span class="hljs-keyword">if</span> (disabled) <span class="hljs-keyword">return</span>;<br>  <span class="hljs-keyword">const</span> containerInfo = container.<span class="hljs-title function_">getBoundingClientRect</span>();<br>  <span class="hljs-keyword">if</span> (!containerInfo.<span class="hljs-property">width</span> &amp;&amp; !containerInfo.<span class="hljs-property">height</span>) <span class="hljs-keyword">return</span>;<br>  <span class="hljs-keyword">let</span> shouldTrigger = <span class="hljs-literal">false</span>;<br>  <span class="hljs-keyword">if</span> (container === el) &#123;<br>    <span class="hljs-keyword">const</span> scrollBottom = container.<span class="hljs-property">scrollTop</span> + <span class="hljs-title function_">getClientHeight</span>(container);<br>    shouldTrigger = container.<span class="hljs-property">scrollHeight</span> - scrollBottom &lt;= distance;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">const</span> heightBelowTop = <span class="hljs-title function_">getOffsetHeight</span>(el) + <span class="hljs-title function_">getElementTop</span>(el) - <span class="hljs-title function_">getElementTop</span>(container);<br>    <span class="hljs-keyword">const</span> offsetHeight = <span class="hljs-title function_">getOffsetHeight</span>(container);<br>    <span class="hljs-keyword">const</span> borderBottom = <span class="hljs-title class_">Number</span>.<span class="hljs-built_in">parseFloat</span>(<span class="hljs-title function_">getStyleComputedProperty</span>(container, <span class="hljs-string">&#x27;borderBottomWidth&#x27;</span>));<br>    shouldTrigger = heightBelowTop - offsetHeight + borderBottom &lt;= distance;<br>  &#125;<br>  <span class="hljs-keyword">if</span> (shouldTrigger &amp;&amp; <span class="hljs-title function_">isFunction</span>(cb)) &#123;<br>    cb.<span class="hljs-title function_">call</span>(vm);<br>  &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (observer) &#123;<br>    observer.<span class="hljs-title function_">disconnect</span>();<br>    <span class="hljs-variable language_">this</span>[scope].<span class="hljs-property">observer</span> = <span class="hljs-literal">null</span>;<br>  &#125;<br>&#125;;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>  <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;InfiniteScroll&#x27;</span>,<br>  <span class="hljs-title function_">inserted</span>(<span class="hljs-params">el, binding, vnode</span>) &#123;<br>    <span class="hljs-keyword">const</span> cb = binding.<span class="hljs-property">value</span>;<br><br>    <span class="hljs-keyword">const</span> container = <span class="hljs-title function_">getScrollContainer</span>(el, <span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">const</span> &#123; delay, immediate &#125; = <span class="hljs-title function_">getScrollOptions</span>(el, vm);<br>    <span class="hljs-keyword">const</span> onScroll = <span class="hljs-title function_">throttle</span>(delay, handleScroll.<span class="hljs-title function_">bind</span>(el, cb));<br><br>    <span class="hljs-keyword">if</span> (container) &#123;<br>      container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;scroll&#x27;</span>, onScroll);<br><br>      <span class="hljs-keyword">if</span> (immediate) &#123;<br>        <span class="hljs-keyword">const</span> observer = el[scope].<span class="hljs-property">observer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutationObserver</span>(onScroll);<br>        observer.<span class="hljs-title function_">observe</span>(container, &#123; <span class="hljs-attr">childList</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">subtree</span>: <span class="hljs-literal">true</span> &#125;);<br>        <span class="hljs-title function_">onScroll</span>();<br>      &#125;<br>    &#125;<br>  &#125;,<br>  <span class="hljs-title function_">unbind</span>(<span class="hljs-params">el</span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; container, onScroll &#125; = el[scope];<br>    <span class="hljs-keyword">if</span> (container) &#123;<br>      container.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">&#x27;scroll&#x27;</span>, onScroll);<br>    &#125;<br>  &#125;<br>&#125;;<br></code></pre></div></td></tr></table></figure>

<p>　　在<code>inserted</code>函数中逻辑也很简单，首先cb就是我们自定义的回调函数，用来触发；通过<code>getScrollContainer</code>判断我们的el是否是滚动容器，然后将<code>handleScroll</code>处理滚动逻辑的函数用节流函数throttle进行封装成onScroll，绑定到容器的滚动事件上去。</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　我们在文档中还看到有四个参数，都是以<code>infinite-scroll-</code>开头的，用来控制触发加载函数的时间；在源码中我们看到它是通过<code>getScrollOptions</code>函数来进行获取，定义了一个对象用来存储这四个参数的名称、类型和默认值，用Object.keys变成数组后再通过<code>reduce</code>函数处理变成map对象返回。</p>
<h2 id="函数调用组件"><a href="#函数调用组件" class="headerlink" title="函数调用组件"></a>函数调用组件</h2><p>　　函数组件调用后会将组件插入到body或者其他节点中去，就不能够通过<code>Vue.component</code>注册到全局组件；而是通过<code>Vue.extend</code>创建一个子类构造器，参数是包含组件选项的对象，构造器实例化后通过<code>$mount</code>挂载到页面元素上去。</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> <span class="hljs-title class_">MyMessage</span> = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(&#123;<br>  <span class="hljs-attr">template</span>: <span class="hljs-string">&#x27;&lt;div&gt;number:&#123;&#123;number&#125;&#125;&lt;/div&gt;&#x27;</span>,<br>  <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">number</span>: <span class="hljs-number">1</span><br>    &#125;<br>  &#125;<br>&#125;)<br><span class="hljs-keyword">let</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyMessage</span>()<br>instance.$mount(<span class="hljs-string">&#x27;#components&#x27;</span>)<br></code></pre></div></td></tr></table></figure>

<p>　　或者实例化后通过<code>$mount</code>获取到DOM结构，然后挂载到body上：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">let</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyMessage</span>()<br>instance.$mount()<br><span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(instance.<span class="hljs-property">$el</span>)<br></code></pre></div></td></tr></table></figure>


<h3 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h3><p>　　Message组件在入口文件中就挂载到全局变量$message上，然后通过<code>this.$message()</code>来进行调用，还能通过<code>this.$message.error()</code>的方式来调用，因此我们猜测Message肯定是一个函数，在这个函数上面还挂载了success、error等函数来复用Message函数本身；我们来看下Message源码（部分）：</p>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//packages/message/src/main.js</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Main</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./main.vue&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; isVNode &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-ui/src/utils/vdom&#x27;</span>;<br><span class="hljs-keyword">let</span> <span class="hljs-title class_">MessageConstructor</span> = <span class="hljs-title class_">Vue</span>.<span class="hljs-title function_">extend</span>(<span class="hljs-title class_">Main</span>);<br><br><span class="hljs-keyword">let</span> instance;<br><span class="hljs-keyword">let</span> instances = [];<br><span class="hljs-keyword">let</span> seed = <span class="hljs-number">1</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title class_">Message</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) &#123;<br>  options = options || &#123;&#125;;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options === <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>    options = &#123;<br>      <span class="hljs-attr">message</span>: options<br>    &#125;;<br>  &#125;<br>  <span class="hljs-keyword">let</span> id = <span class="hljs-string">&#x27;message_&#x27;</span> + seed++;<br>  instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageConstructor</span>(&#123;<br>    <span class="hljs-attr">data</span>: options<br>  &#125;);<br>  instance.<span class="hljs-property">id</span> = id;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isVNode</span>(instance.<span class="hljs-property">message</span>)) &#123;<br>    instance.<span class="hljs-property">$slots</span>.<span class="hljs-property">default</span> = [instance.<span class="hljs-property">message</span>];<br>    instance.<span class="hljs-property">message</span> = <span class="hljs-literal">null</span>;<br>  &#125;<br>  instance.$mount();<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(instance.<span class="hljs-property">$el</span>);<br>  <span class="hljs-keyword">let</span> verticalOffset = options.<span class="hljs-property">offset</span> || <span class="hljs-number">20</span>;<br>  instances.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> &#123;<br>    verticalOffset += item.<span class="hljs-property">$el</span>.<span class="hljs-property">offsetHeight</span> + <span class="hljs-number">16</span>;<br>  &#125;);<br>  instance.<span class="hljs-property">verticalOffset</span> = verticalOffset;<br>  instance.<span class="hljs-property">visible</span> = <span class="hljs-literal">true</span>;<br>  instances.<span class="hljs-title function_">push</span>(instance);<br>  <span class="hljs-keyword">return</span> instance;<br>&#125;;<br><br>[<span class="hljs-string">&#x27;success&#x27;</span>, <span class="hljs-string">&#x27;warning&#x27;</span>, <span class="hljs-string">&#x27;info&#x27;</span>, <span class="hljs-string">&#x27;error&#x27;</span>].<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">type</span> =&gt;</span> &#123;<br>  <span class="hljs-title class_">Message</span>[type] = <span class="hljs-function"><span class="hljs-params">options</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options === <span class="hljs-string">&#x27;string&#x27;</span>) &#123;<br>      options = &#123;<br>        <span class="hljs-attr">message</span>: options<br>      &#125;;<br>    &#125;<br>    options.<span class="hljs-property">type</span> = type;<br>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Message</span>(options);<br>  &#125;;<br>&#125;);<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Message</span>;<br></code></pre></div></td></tr></table></figure>

<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　我们发现在Message的构造函数中首先对options进行一个处理，因为可以传入字符串或者对象两种调用方式，因此首先把字符串的<code>options</code>统一成对象形式；然后通过Vue.extend创建的构造函数实例化一个instance，将所有的参数options传到instance中进行渲染，最后把instance.$el插入到页面上去渲染；这里为了对所有的实例进行管理，比如根据所有实例个数，渲染最后一个实例的高度还有关闭实例对象等操作，因此维护了一个数组instances来进行管理，还给每个实例一个自增id方便进行查找。</p>
<p>　　然后我们来看下Vue.extend传入的参数main.vue的源码（部分）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">//packages/message/src/main.vue<br>&lt;template&gt;<br>  &lt;transition name=&quot;el-message-fade&quot; @after-leave=&quot;handleAfterLeave&quot;&gt;<br>    &lt;div<br>      :class=&quot;[<br>        &#x27;el-message&#x27;,<br>        type &amp;&amp; !iconClass ? `el-message--$&#123; type &#125;` : &#x27;&#x27;,<br>        center ? &#x27;is-center&#x27; : &#x27;&#x27;,<br>        showClose ? &#x27;is-closable&#x27; : &#x27;&#x27;,<br>        customClass<br>      ]&quot;<br>      :style=&quot;positionStyle&quot;<br>      v-show=&quot;visible&quot;<br>      @mouseenter=&quot;clearTimer&quot;<br>      @mouseleave=&quot;startTimer&quot;<br>      role=&quot;alert&quot;&gt;<br>      &lt;i :class=&quot;iconClass&quot; v-if=&quot;iconClass&quot;&gt;&lt;/i&gt;<br>      &lt;i :class=&quot;typeClass&quot; v-else&gt;&lt;/i&gt;<br>      &lt;slot&gt;<br>        &lt;p v-if=&quot;!dangerouslyUseHTMLString&quot; class=&quot;el-message__content&quot;&gt;&#123;&#123; message &#125;&#125;&lt;/p&gt;<br>        &lt;p v-else v-html=&quot;message&quot; class=&quot;el-message__content&quot;&gt;&lt;/p&gt;<br>      &lt;/slot&gt;<br>      &lt;i v-if=&quot;showClose&quot; class=&quot;el-message__closeBtn el-icon-close&quot; @click=&quot;close&quot;&gt;&lt;/i&gt;<br>    &lt;/div&gt;<br>  &lt;/transition&gt;<br>&lt;/template&gt;<br>&lt;script type=&quot;text/babel&quot;&gt;<br>  export default &#123;<br>    data() &#123;<br>      return &#123;<br>        visible: false,<br>        message: &#x27;&#x27;,<br>        duration: 3000,<br>        type: &#x27;info&#x27;,<br>        iconClass: &#x27;&#x27;,<br>        customClass: &#x27;&#x27;,<br>        onClose: null,<br>        showClose: false,<br>        closed: false,<br>        verticalOffset: 20,<br>        timer: null,<br>        dangerouslyUseHTMLString: false,<br>        center: false<br>      &#125;;<br>    &#125;,<br>    methods: &#123;<br>      handleAfterLeave() &#123;<br>        this.$destroy(true);<br>        this.$el.parentNode.removeChild(this.$el);<br>      &#125;,<br>    &#125;,<br>  &#125;;<br>&lt;/script&gt;<br></code></pre></div></td></tr></table></figure>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>

<p>　　我们看到这里data参数和文档中给出的参数是一样的，在上面构造函数中正是通过options传入进来进行覆盖；这里关闭组件是通过watch监听closed是否为true，然后再给<code>visible</code>赋值false；那么页面上明明渲染的是visible，为什么这里不直接给visible赋值呢？个人猜测是为了在关闭的同时触发回调函数<code>onClose</code>；在组件动画结束后也调用了<code>parentNode.removeChild</code>将组件从body中移除，</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>　　我们从webpack配置文件入手，找到了入口文件进行组件的注册配置和导出，对众多的组件进行了分类，归为三大类；由于文章篇幅有限，这里只展示了每一类组件中部分组件的源码，像很多常用的组件，比如Input、Radio和Checkbox等很多组件都是大同小异，大家可以继续深入学习其源码；在看源码的同时建议可以查看官方文档中的参数以及参数说明，这样能够更好地理解源码中的思想逻辑，不至于看的一头雾水。</p>

<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/programing/">编程</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/FrontEnd/">前端</a>
                    
                      <a class="hover-with-bg" href="/tags/SourceCode/">源码</a>
                    
                      <a class="hover-with-bg" href="/tags/Vue/">Vue</a>
                    
                      <a class="hover-with-bg" href="/tags/Componentization/">组件化</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本网所有内容文字和图片，版权均属谢小飞所有，任何媒体、网站或个人未经本网协议授权不得转载、链接、转贴或以其他方式复制发布/发表。如需转载请关注公众号【前端壹读】后回复【转载】。
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/03/10/DesignPattern-Observer.html">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">JS设计模式之观察者模式</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/01/28/Package-Tool-Compare.html">
                        <span class="hidden-mobile">深入对比Webpack、Parcel、Rollup打包工具的不同</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createScript('https://xieyufei.com/npm/waline@1.6.0/Waline.min.js', function() {
        var options = Object.assign(
          {"serverURL":"https://comment.xieyufei.com","placeholder":"说点什么","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":true,"avatarCDN":"","avatarForce":false,"requiredFields":[],"emojiCDN":null,"emojiMaps":null,"anonymous":null,"appId":"dUHCmA1MmCKBNcTMG9KBopvL-MdYXbMMI","appKey":"33GvkVfTefXyelQRBTXNgEn6"},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        new Waline(options);
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="javascript:; target="_blank" rel="nofollow noopener"><span>We</span></a> <i class="iconfont icon-love"></i> <a href="https://xieyufei.com" target="_blank" rel="nofollow noopener"><span>谢小飞</span></a> <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  

  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        苏ICP备2024128889号-1
      </a>
    </span>
    
  </div>


  
    <!-- cnzz Analytics Icon -->
    <span id="cnzz_stat_icon_1260607518" style="display: none"></span>
  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://xieyufei.com/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://xieyufei.com/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://xieyufei.com/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://xieyufei.com/npm/bootstrap/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://xieyufei.com/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://xieyufei.com/npm/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://xieyufei.com/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://xieyufei.com/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>






  <script  src="https://xieyufei.com/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?466240fe55764d8ee20bd7f43c5e8b26";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  
    <!-- cnzz Analytics -->
    <script defer src="//s4.cnzz.com/z_stat.php?id=1260607518&show=pic"
            type="text/javascript"></script>
  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
