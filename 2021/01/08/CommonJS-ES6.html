

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" href="/img/favicon.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="　　前端模块化是前端工程化的第一步也是重要的一步；不管你是使用React，还是Vue，亦或是Nodejs，都离不开模块化。模块化的规范有很多，而现在用的最多的就是CommonJS和ES6规范，因此我们来深入了解这两个规范以及两者之间的区别。">
  <meta name="author" content="Corner">
  <meta name="keywords" content="Corner">
  
  <title>深入学习CommonJS和ES6模块化规范 - 谢小飞的博客</title>

  <link  rel="stylesheet" href="https://xieyufei.com/npm/bootstrap/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://xieyufei.com/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://xieyufei.com/npm/highlight.js@10.7.2/styles/vs2015.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://xieyufei.com/npm/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"xieyufei.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"466240fe55764d8ee20bd7f43c5e8b26","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":1260607518,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/title.js" ></script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="谢小飞的博客" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>谢小飞的博客</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-pen"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-friends"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="https://gallery.xieyufei.com/">
                <i class="iconfont icon-link-fill"></i>
                创意
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/bookshelf/">
                <i class="iconfont icon-books"></i>
                书架
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('//xieyufei.com/blog/bg_small.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="深入学习CommonJS和ES6模块化规范">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-01-08 12:00" pubdate>
        2021年1月8日 中午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      4.4k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      57
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      
<style>
  .prevent_reptile{
    display: none;
  }
</style>
<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">深入学习CommonJS和ES6模块化规范</h1>
            
            <div class="markdown-body">
              <p>　　前端模块化是前端工程化的第一步也是重要的一步；不管你是使用React，还是Vue，亦或是Nodejs，都离不开模块化。模块化的规范有很多，而现在用的最多的就是CommonJS和ES6规范，因此我们来深入了解这两个规范以及两者之间的区别。</p>
<span id="more"></span>

<h1 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h1><p>　　CommonJS规范是一种同步加载模块的方式，也就是说，只有当模块加载完成后，才能执行后面的操作。由于Nodejs主要用于服务器端编程，而模块文件一般都已经存在于本地硬盘，加载起来比较快，因此同步加载模块的CommonJS规范就比较适用。</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>　　CommonJS规范规定，每一个JS文件就是一个模块，有自己的作用域；在一个模块中定义的变量、函数等都是私有变量，对其他文件不可见。</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// number.js</span><br><span class="hljs-keyword">let</span> num = <span class="hljs-number">1</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x</span>) &#123;<br>    <span class="hljs-keyword">return</span> num + x<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>　　在上面的number.js中，变量num和函数add就是当前文件私有的，其他文件不能访问。同时CommonJS规定了，每个模块内部都有一个<code>module</code>变量，代表当前模块；这个变量是一个对象，它的<code>exports</code>属性（即<code>module.exports</code>）提供对外导出模块的接口。</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// number.js</span><br><span class="hljs-keyword">let</span> num = <span class="hljs-number">1</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x</span>) &#123;<br>    <span class="hljs-keyword">return</span> num + x<br>&#125;<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">num</span> = num<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">add</span> = add<br></code></pre></div></td></tr></table></figure>

<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　这样我们定义的私有变量就能提供对外访问；加载某一个模块，就是加载这个模块的<code>module.exports</code>属性。</p>
<h2 id="module"><a href="#module" class="headerlink" title="module"></a>module</h2><p>　　上面说到，<code>module</code>变量代表当前模块，我们来打印看一下它里面有哪些信息：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//temp.js</span><br><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./a.js&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">module</span>)<br><br><span class="hljs-title class_">Module</span> &#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;.&#x27;</span>,<br>  <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;D:\\demo&#x27;</span>,<br>  <span class="hljs-attr">exports</span>: &#123;&#125;,<br>  <span class="hljs-attr">parent</span>: <span class="hljs-literal">null</span>,<br>  <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;D:\\demo\\temp.js&#x27;</span>,<br>  <span class="hljs-attr">loaded</span>: <span class="hljs-literal">false</span>,<br>  <span class="hljs-attr">children</span>: [&#123;<br>    <span class="hljs-title class_">Module</span> &#123;<br>      <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;D:\\demo\\a.js&#x27;</span>,<br>      <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;D:\\demo&#x27;</span>,<br>      <span class="hljs-attr">exports</span>: &#123;&#125;,<br>      <span class="hljs-attr">parent</span>: [<span class="hljs-title class_">Circular</span>],<br>      <span class="hljs-attr">filename</span>: <span class="hljs-string">&#x27;D:\\demo\\a.js&#x27;</span>,<br>      <span class="hljs-attr">loaded</span>: <span class="hljs-literal">true</span>,<br>      <span class="hljs-attr">children</span>: [],<br>      <span class="hljs-attr">paths</span>: [<span class="hljs-title class_">Array</span>]<br>    &#125;<br>  &#125;],<br>  <span class="hljs-attr">paths</span>: [<br>    <span class="hljs-string">&#x27;D:\\demo\\node_modules&#x27;</span>,<br>    <span class="hljs-string">&#x27;D:\\projects\\mynodejs\\node_modules&#x27;</span>,<br>    <span class="hljs-string">&#x27;D:\\projects\\node_modules&#x27;</span>,<br>    <span class="hljs-string">&#x27;D:\\node_modules&#x27;</span><br>  ]<br>&#125;<br></code></pre></div></td></tr></table></figure>


<p>　　我们发现它有以下属性：</p>
<ul>
<li>id：模块的识别符，通常是带有绝对路径的模块文件名</li>
<li>filename：模块的文件名，带有绝对路径。</li>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<li>loaded：返回一个布尔值，表示模块是否已经完成加载。</li>
<li>parent：返回一个对象，表示调用该模块的模块。</li>
<li>children：回一个数组，表示该模块要用到的其他模块。</li>
<li>exports：模块对外输出的对象。</li>
<li>path：模块的目录名称。</li>
<li>paths：模块的搜索路径。</li>
</ul>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<p>　　如果我们通过命令行调用某个模块，比如<code>node temp.js</code>，那么这个模块就是顶级模块，它的<code>module.parent</code>就是null；如果是在其他模块中被调用，比如<code>require(&#39;temp.js&#39;)</code>，那么它的<code>module.parent</code>就是调用它的模块。</p>
<p>　　但是在最新的Nodejs 14.6版本中<code>module.parent</code>被弃用了，官方推荐使用<code>require.main</code>或者<code>module.children</code>代替，我们来看一下弃用的原因：</p>
<blockquote>
<p><code>module.parent</code>值为通过required引用的这个模块的值。如果为当前运行进程的入口，值为null。如果这个模块被非commonJS格式引入，如REPL，或者import导入，值为undefined</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
</blockquote>
<h2 id="exports"><a href="#exports" class="headerlink" title="exports"></a>exports</h2><p>　　为了导出模块方便，我们还可以通过<code>exports</code>变量，它指向<code>module.exports</code>，因此这就相当于在每个模块<strong>隐性</strong>的添加了这样一行代码：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> <span class="hljs-built_in">exports</span> = <span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>;<br></code></pre></div></td></tr></table></figure>

<p>　　在对外输出模块时，可以向exports对象添加属性。</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// number.js</span><br><span class="hljs-keyword">let</span> num = <span class="hljs-number">1</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x</span>) &#123;<br>    <span class="hljs-keyword">return</span> num + x<br>&#125;<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">num</span> = num<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">add</span> = add<br></code></pre></div></td></tr></table></figure>


<p>　　需要<strong>注意</strong>的是，不能直接将<code>exports</code>变量指向一个值，因为这样等于切断了<code>exports</code>和<code>module.exports</code>之间的联系</p>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// a.js</span><br><span class="hljs-built_in">exports</span> = <span class="hljs-string">&#x27;a&#x27;</span><br><span class="hljs-comment">// main.js</span><br><span class="hljs-keyword">var</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./a&#x27;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a)<br><span class="hljs-comment">// &#123;&#125;</span><br></code></pre></div></td></tr></table></figure>

<p>　　虽然我们通过<code>exports</code>导出了字符串，但是由于切断了<code>exports = module.exports</code>之间的联系，而<code>module.exports</code>实际上还是指向了空对象，最终导出的结果也是空对象。</p>
<h2 id="require"><a href="#require" class="headerlink" title="require"></a>require</h2><p>　　require的基本功能是读取并执行JS文件，并返回模块导出的<code>module.exports</code>对象：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">const</span> number = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./number.js&quot;</span>)<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number.<span class="hljs-property">num</span>)<br>number.<span class="hljs-title function_">add</span>()<br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>

<p>　　如果模块导出的是一个函数，就不能定义在<code>exports</code>对象上：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// number.js</span><br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;number&quot;</span>)<br>&#125;<br><br><span class="hljs-comment">// main.js</span><br><span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./number.js&quot;</span>)()<br></code></pre></div></td></tr></table></figure>

<p>　　require除了能够作为函数调用加载模块以外，它本身作为一个对象还有以下属性：</p>
<ul>
<li>resolve：需要解析的模块路径。</li>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<li>main：<code>Module</code>对象，表示当进程启动时加载的入口脚本。</li>
<li>extensions：如何处理文件扩展名。</li>
<li>cache：被引入的模块将被缓存在这个对象中。</li>
</ul>
<h2 id="模块缓存"><a href="#模块缓存" class="headerlink" title="模块缓存"></a>模块缓存</h2><p>　　当我们在一个项目中多次<code>require</code>同一个模块时，CommonJS并不会多次执行该模块文件；而是在第一次加载时，将模块缓存；以后再加载该模块时，就直接从缓存中读取该模块：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//number.js</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;run number.js&#x27;</span>)<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> =  &#123;<br>    <span class="hljs-attr">num</span>: <span class="hljs-number">1</span><br>&#125;<br><br><span class="hljs-comment">//main.js</span><br><span class="hljs-keyword">let</span> number1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./number&quot;</span>);<br><br><span class="hljs-keyword">let</span> number2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./number&quot;</span>);<br>number2.<span class="hljs-property">num</span> = <span class="hljs-number">2</span><br><br><span class="hljs-keyword">let</span> number3 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./number&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number3)<br><br><span class="hljs-comment">// run number.js</span><br><span class="hljs-comment">// &#123; num: 2 &#125; </span><br></code></pre></div></td></tr></table></figure>

<p>　　我们多次require加载number模块，但是内部只有一次打印输出；第二次加载时还改变了内部变量的值，第三次加载时内部变量的值还是上一次的赋值，这就证明了后面的<code>require</code>读取的是缓存。</p>
<p>　　在上面<code>require</code>中，我们介绍了它下面所有的属性，发现有一个cache属性，就是用来缓存模块的，我们先打印看一下：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">&#123;<br>    <span class="hljs-string">&#x27;D:\\demo\\main.js&#x27;</span>: <span class="hljs-title class_">Module</span> &#123;&#125;,<br>    <span class="hljs-string">&#x27;D:\\demo\\number.js&#x27;</span>: <span class="hljs-title class_">Module</span> &#123;&#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>


<p>　　cache按照路径的形式将模块进行缓存，我们可以通过<code>delete require.cache[modulePath]</code>将缓存的模块删除；我们把上面的代码改写一下：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//number.js</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;run number.js&#x27;</span>)<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> =  &#123;<br>    <span class="hljs-attr">num</span>: <span class="hljs-number">1</span><br>&#125;<br><br><span class="hljs-comment">//main.js</span><br><span class="hljs-keyword">let</span> number1 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./number&quot;</span>);<br><br><span class="hljs-keyword">let</span> number2 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./number&quot;</span>);<br>number2.<span class="hljs-property">num</span> = <span class="hljs-number">2</span><br><br><span class="hljs-comment">//删除缓存</span><br><span class="hljs-keyword">delete</span> <span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span>[<span class="hljs-string">&#x27;D:\\demo\\number.js&#x27;</span>]<br><br><span class="hljs-keyword">let</span> number3 = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./number&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number3)<br><br><span class="hljs-comment">// run number.js</span><br><span class="hljs-comment">// run number.js</span><br><span class="hljs-comment">// &#123; num: 1 &#125; </span><br></code></pre></div></td></tr></table></figure>

<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>

<p>　　很明显的发现，number模块运行了两遍，第二次加载模块我们又把模块的缓存给清除了，因此第三次读取的num值也是最新的；我们也可以通过<code>Object.keys</code>循环来删除所有模块的缓存：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) &#123;<br>  <span class="hljs-keyword">delete</span> <span class="hljs-built_in">require</span>.<span class="hljs-property">cache</span>[key];<br>&#125;)<br></code></pre></div></td></tr></table></figure>

<h2 id="加载机制"><a href="#加载机制" class="headerlink" title="加载机制"></a>加载机制</h2><p>　　CommonJS的加载机制是，模块输出的是一个值的复制拷贝；对于基本数据类型的输出，属于复制，对于复杂数据类型，属于浅拷贝，我们来看一个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// number.js</span><br><span class="hljs-keyword">let</span> num = <span class="hljs-number">1</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>) &#123;<br>    num++<br>&#125;<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">num</span> = num<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span>.<span class="hljs-property">add</span> = add<br><br><span class="hljs-comment">// main.js</span><br><span class="hljs-keyword">var</span> number = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./number&#x27;</span>)<br><span class="hljs-comment">//1</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number.<span class="hljs-property">num</span>)<br><br>number.<span class="hljs-title function_">add</span>()<br><span class="hljs-comment">//1</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number.<span class="hljs-property">num</span>)<br><br>number.<span class="hljs-property">num</span> = <span class="hljs-number">3</span><br><span class="hljs-comment">//3</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number.<span class="hljs-property">num</span>)<br></code></pre></div></td></tr></table></figure>

<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　由于CommonJS是<strong>值的复制</strong>，一旦模块输出了值，模块内部的变化就影响不到这个值；因此main.js中的<code>number</code>变量本身和<code>number.js</code>没有任何指向关系了，虽然我们调用模块内部的<code>add</code>函数来改变值，但也影响不到这个值了；反而我们在输出后可以对这个值进行任意的编辑。</p>
<p>　　针对<code>require</code>这个特性，我们也可以理解为它将模块放到自执行函数中执行：</p>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">var</span> number = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">let</span> num = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>) &#123;<br>        num++<br>    &#125;<br>    <span class="hljs-keyword">return</span> &#123;<br>        num,<br>        add,<br>    &#125;<br>&#125;)()<br><span class="hljs-comment">//1</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number.<span class="hljs-property">num</span>)<br><br>number.<span class="hljs-title function_">add</span>()<br><span class="hljs-comment">//1</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number.<span class="hljs-property">num</span>)<br></code></pre></div></td></tr></table></figure>

<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　而对于复杂数据类型，由于CommonJS进行了浅拷贝，因此如果两个脚本同时引用了同一个模块，对该模块的修改会影响另一个模块：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// obj.js</span><br><span class="hljs-keyword">var</span> obj = &#123;<br>    <span class="hljs-attr">color</span>: &#123;<br>        <span class="hljs-attr">list</span>: [<span class="hljs-string">&#x27;red&#x27;</span>, <span class="hljs-string">&#x27;yellow&#x27;</span>,<span class="hljs-string">&#x27;blue&#x27;</span>]<br>    &#125;<br>&#125;<br><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = obj<br><br><span class="hljs-comment">//a.js</span><br><span class="hljs-keyword">var</span> obj = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./obj&#x27;</span>)<br>obj.<span class="hljs-property">color</span>.<span class="hljs-property">list</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">&#x27;green&#x27;</span>)<br><span class="hljs-comment">//&#123; color: &#123; list: [ &#x27;red&#x27;, &#x27;yellow&#x27;, &#x27;blue&#x27;, &#x27;green&#x27; ] &#125; &#125;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj)<br><br><span class="hljs-comment">//b.js</span><br><span class="hljs-keyword">var</span> obj = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./obj&#x27;</span>)<br><span class="hljs-comment">//&#123; color: &#123; list: [ &#x27;red&#x27;, &#x27;yellow&#x27;, &#x27;blue&#x27;, &#x27;green&#x27; ] &#125; &#125;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj)<br><br><span class="hljs-comment">//main.js</span><br><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./a&#x27;</span>)<br><span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./b&#x27;</span>)<br></code></pre></div></td></tr></table></figure>

<p>　　上面代码中我们通过a.js、b.js两个脚本同时引用一个模块进行修改和读取；需要注意的是由于缓存，因此b.js加载时其实已经是从缓存中读取的模块。</p>
<p>　　我们上面说过<code>require</code>加载时，会执行模块中的代码，然后将模块的<code>module.exports</code>属性作为返回值进行返回；我们发现这个加载过程发生在代码的运行阶段，而在模块被执行前，没有办法确定模块的依赖关系，这种加载加载方式称为<code>运行时加载</code>；由于CommonJS运行时加载模块，我们甚至能够通过判断语句，动态的选择去加载某个模块：</p>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">let</span> num = <span class="hljs-number">10</span>;<br><br><span class="hljs-keyword">if</span> (num &gt; <span class="hljs-number">2</span>) &#123;<br>    <span class="hljs-keyword">var</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./a&quot;</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">var</span> b = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./b&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">var</span> moduleName = <span class="hljs-string">&#x27;number.js&#x27;</span><br><br><span class="hljs-keyword">var</span> number = <span class="hljs-built_in">require</span>(<span class="hljs-string">`./<span class="hljs-subst">$&#123;moduleName&#125;</span>`</span>)<br></code></pre></div></td></tr></table></figure>


<p>　　但也正是由于这种动态加载，导致没有办法在编译时做静态优化。</p>
<h2 id="循环加载"><a href="#循环加载" class="headerlink" title="循环加载"></a>循环加载</h2><p>　　由于缓存机制的存在，CommonJS的模块之间可以进行循环加载，而不用担心引起死循环：</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//a.js</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">a</span> = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">var</span> b = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./b&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b, <span class="hljs-string">&quot;a.js&quot;</span>);<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">a</span> = <span class="hljs-number">2</span>;<br><br><br><span class="hljs-comment">//b.js</span><br><span class="hljs-built_in">exports</span>.<span class="hljs-property">b</span> = <span class="hljs-number">11</span>;<br><span class="hljs-keyword">var</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./a&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, <span class="hljs-string">&quot;b.js&quot;</span>);<br><span class="hljs-built_in">exports</span>.<span class="hljs-property">b</span> = <span class="hljs-number">22</span>;<br><br><br><span class="hljs-comment">//main.js</span><br><span class="hljs-keyword">const</span> a = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./a&quot;</span>);<br><span class="hljs-keyword">const</span> b = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;./b&quot;</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, <span class="hljs-string">&quot;main a&quot;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b, <span class="hljs-string">&quot;main b&quot;</span>);<br></code></pre></div></td></tr></table></figure>


<p><img src="/images/CommonJS-ES6/circle.png" srcset="/img/loading.gif" lazyload alt="circle.png"></p>
<p>　　在上面代码中，逻辑看似很复杂，a.js加载了b.js，而b.js加载了a.js；但是我们逐一来进行分析，就会发现其实很简单。</p>
<ol>
<li>加载main.js，发现加载了a模块；读取并存入缓存</li>
<li>执行a模块，导出了{a:1}；发现加载了b模块去，读取并存入缓存</li>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<li>执行b模块，导出了{b:11}；又加载了a模块，读取缓存，此时a模块只导出了{a:1}</li>
<li>b模块执行完毕，导出了{b:22}</li>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<li>回到a模块，执行完毕，导出{a:2}</li>
<li>回到main.js，又加载了b模块，读取缓存</li>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
</ol>
<p>　　因此最后打印的结果：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js">&#123; <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> &#125; b.<span class="hljs-property">js</span>   <br>&#123; <span class="hljs-attr">b</span>: <span class="hljs-number">22</span> &#125; a.<span class="hljs-property">js</span>  <br>&#123; <span class="hljs-attr">a</span>: <span class="hljs-number">2</span> &#125; main a <br>&#123; <span class="hljs-attr">b</span>: <span class="hljs-number">22</span> &#125; main b<br></code></pre></div></td></tr></table></figure>

<p>　　尤其需要注意的是第一个b模块中的console，由于此时a模块虽然已经加载在缓存中，但是并没有执行完成，a模块只导出了第一个<code>&#123;a:1&#125;</code>。</p>
<p>　　我们发现循环加载，属于加载时执行；一旦某个模块被循环加载，就只输出已经执行的部分，还未执行的部分不会输出。</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<h1 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h1><p>　　与CommonJS规范动态加载不同，ES6模块化的设计思想是尽量的静态化，使得在编译时就能够确定模块之间的依赖关系。我们在<a href="https://xieyufei.com/2020/07/30/Webpack-Optimize.html">Webpack配置全解析（优化篇）</a>就聊到，利用ES6模块静态化加载方案，就可以实现<code>Tree Shaking</code>来优化代码。</p>
<h2 id="export"><a href="#export" class="headerlink" title="export"></a>export</h2><p>　　和CommonJS相同，ES6规范也定义了一个JS文件就是一个独立模块，模块内部的变量都是私有化的，其他模块无法访问；不过ES6通过<code>export</code>关键词来导出变量、函数或者类：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> num = <span class="hljs-number">1</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x</span>) &#123;<br>    <span class="hljs-keyword">return</span> num + x<br>&#125;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;&#125;<br></code></pre></div></td></tr></table></figure>


<p>　　或者我们也可以直接导出一个对象，这两种方式是等价的：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">let</span> num = <span class="hljs-number">1</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x</span>) &#123;<br>    <span class="hljs-keyword">return</span> num + x<br>&#125; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;&#125;<br><span class="hljs-keyword">export</span> &#123; num, add, <span class="hljs-title class_">Person</span> &#125;<br></code></pre></div></td></tr></table></figure>

<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<p>　　在导出对象时，我们还可以使用<code>as</code>关键词重命名导出的变量：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">let</span> num = <span class="hljs-number">1</span><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x</span>) &#123;<br>    <span class="hljs-keyword">return</span> num + x<br>&#125; <br><br><span class="hljs-keyword">export</span> &#123;<br>    num <span class="hljs-keyword">as</span> number,<br>    num <span class="hljs-keyword">as</span> counter,<br>    add <span class="hljs-keyword">as</span> addCount,<br>    add <span class="hljs-keyword">as</span> addFunction<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　通过<code>as</code>重名了，我们将变量进行了多次的导出。需要注意的是，<code>export</code>规定，导出的是对外的接口，必须与模块内部的变量建立一一对应的关系。下面两种是错误的写法：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// 报错，是个值，没有提供接口</span><br><span class="hljs-keyword">export</span> <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">// 报错，需要放在大括号中</span><br><span class="hljs-keyword">var</span> m = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">export</span> m;<br></code></pre></div></td></tr></table></figure>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>


<h2 id="import"><a href="#import" class="headerlink" title="import"></a>import</h2><p>　　使用<code>export</code>导出模块对外接口后，其他模块文件可以通过<code>import</code>命令加载这个接口：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;<br>    number,<br>    counter,<br>    addCount,<br>    addFunction<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./number.js&quot;</span><br></code></pre></div></td></tr></table></figure>

<p>　　上面代码从number.js模块中加载了变量，import命令接受一对大括号，里面指定了从模块导入变量名，导入的变量名必须与被导入模块对外接口的变量名称相同。</p>
<p>　　和export命令一样，我们可以使用<code>as</code>关键字，将导入的变量名进行重命名：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;<br>    number <span class="hljs-keyword">as</span> num,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./number.js&quot;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num)<br></code></pre></div></td></tr></table></figure>

<p>　　除了加载模块中指定变量接口，我们还可以使用整体加载，通过（*）指定一个对象，所有的输出值都加载在这个对象上：</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> number <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./number.js&quot;</span><br></code></pre></div></td></tr></table></figure>

<p>　　import命令具有提升效果，会提升到整个模块的头部，首先执行：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num)<br><span class="hljs-keyword">import</span> &#123;<br>    number <span class="hljs-keyword">as</span> num,<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./number.js&quot;</span><br></code></pre></div></td></tr></table></figure>

<p>　　上面代码不会报错，因为import会优先执行；和CommonJS规范的require不同的是，import是静态执行，因此import不能位于块级作用域内，也不能使用表达式和变量，这些都是只有在运行时才能得到结果的语法结构：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//报错</span><br><span class="hljs-keyword">let</span> moduleName = <span class="hljs-string">&#x27;./num&#x27;</span><br><span class="hljs-keyword">import</span> &#123; num, add &#125; <span class="hljs-keyword">from</span> moduleName;<br><br><br><span class="hljs-comment">//报错</span><br><span class="hljs-comment">//SyntaxError: &#x27;import&#x27; and &#x27;export&#x27; may only appear at the top level </span><br><span class="hljs-keyword">let</span> num = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">if</span> (num &gt; <span class="hljs-number">2</span>) &#123;<br>    <span class="hljs-keyword">import</span> a <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./a&quot;</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">import</span> b <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./b&quot;</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>


<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<h2 id="export-default"><a href="#export-default" class="headerlink" title="export default"></a>export default</h2><p>　　在上面代码中import导入export对外接口时，都需要知道对外接口的准确名称，才能拿到对应的值，这样比较麻烦，有时我们只有一个接口需要导出；为此ES6规范提供了<code>export default</code>来默认导出：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//add.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) &#123;<br>    <span class="hljs-keyword">return</span> x + y;<br>&#125;;<br><span class="hljs-comment">//main.js</span><br><span class="hljs-keyword">import</span> add <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./add&#x27;</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>))<br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>

<p>　　由于<code>export default</code>是默认导出，因此，这个命令在一个模块中只能使用一次，而<code>export</code>导出接口是可以多次导出的：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//报错</span><br><span class="hljs-comment">//SyntaxError: Only one default export allowed per module.</span><br><span class="hljs-comment">//add.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) &#123;<br>    <span class="hljs-keyword">return</span> x + y;<br>&#125;;<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">x, y</span>) &#123;<br>    <span class="hljs-keyword">return</span> x + y + <span class="hljs-number">1</span>;<br>&#125;;<br></code></pre></div></td></tr></table></figure>

<p>　　<code>export default</code>其实是语法糖，本质上是将后面的值赋值给<code>default</code>变量，所以可以将一个值写在<code>export default</code>之后；但是正是由于它是输出了一个<code>default</code>变量，因此它后面不能再跟变量声明语句：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//正确</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-number">10</span><br><br><span class="hljs-comment">//正确</span><br><span class="hljs-keyword">let</span> num = <span class="hljs-number">10</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> num<br><br><span class="hljs-comment">//报错</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">let</span> num = <span class="hljs-number">10</span><br></code></pre></div></td></tr></table></figure>

<p>　　既然<code>export default</code>本质上是导出了一个default变量的语法糖，因此我们也可以通过<code>export</code>来进行改写：</p>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//num.js</span><br><span class="hljs-keyword">let</span> num = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">export</span> &#123; num <span class="hljs-keyword">as</span> <span class="hljs-keyword">default</span> &#125;;<br></code></pre></div></td></tr></table></figure>


<p>　　上面两个代码是等效的；而我们在import导入时，也是把<code>default</code>变量重命名为我们想要的名字，因此下面两个导入代码也是等效的：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> num <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./num&#x27;</span><br><span class="hljs-comment">//等效</span><br><span class="hljs-keyword">import</span> &#123; <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> num &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./num&#x27;</span><br></code></pre></div></td></tr></table></figure>

<p>　　在一个模块中，<code>export</code>可以有多个，<code>export default</code>只能有一个，但是他们两者可以同时存在：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//num.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> num1 = <span class="hljs-number">1</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> num2 = <span class="hljs-number">2</span><br><span class="hljs-keyword">let</span> defaultNum = <span class="hljs-number">3</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> defaultNum<br><br><span class="hljs-comment">//main.js</span><br><span class="hljs-keyword">import</span> defaultNum, &#123;<br>  num1,<br>  num2<br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./num&#x27;</span><br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>


<h2 id="加载机制-1"><a href="#加载机制-1" class="headerlink" title="加载机制"></a>加载机制</h2><p>　　在CommonJS中我们说了，模块的输出是值的复制拷贝；而ES6输出的则是对外接口，我们将上面CommonJS中的代码进行改写来理解两者的区别：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//number.js</span><br><span class="hljs-keyword">let</span> num = <span class="hljs-number">1</span><br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params"></span>) &#123;<br>  num++<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123; num, add &#125;<br><br><span class="hljs-comment">//main.js</span><br><span class="hljs-keyword">import</span> &#123; num, add &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./number.js&#x27;</span><br><br><span class="hljs-comment">//1</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num)<br><span class="hljs-title function_">add</span>()<br><span class="hljs-comment">//2</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num)<br></code></pre></div></td></tr></table></figure>

<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<p>　　我们发现和CommonJS中运行出来结果完全不一样，调用模块中的函数影响了模块中的变量值；正是由于ES6模块只是输出了一个对外的接口，我们可以把这个接口理解为一个<code>引用</code>，实际的值还是在模块中；而且这个<code>引用</code>还是一个<code>只读引用</code>，不论是基本数据类型还是复杂数据类型：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//obj.js</span><br><span class="hljs-keyword">let</span> num = <span class="hljs-number">1</span><br><span class="hljs-keyword">let</span> list = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]<br><br><span class="hljs-keyword">export</span> &#123; num, list &#125;<br><br><span class="hljs-comment">//main.js</span><br><span class="hljs-keyword">import</span> &#123; num, list &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./obj.js&#x27;</span><br><span class="hljs-comment">//Error: &quot;num&quot; is read-only.</span><br>num = <span class="hljs-number">3</span><br><span class="hljs-comment">//Error: &quot;list&quot; is read-only.</span><br>list = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]<br></code></pre></div></td></tr></table></figure>


<p>　　import也会对导入的模块进行缓存，重复import导入同一个模块，只会执行一次，这里就不进行代码演示。</p>
<h2 id="循环引用"><a href="#循环引用" class="headerlink" title="循环引用"></a>循环引用</h2><p>　　ES6模块之间也存在着循环引用，我们还是将CommonJS中的代码来进行改造看一下：</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">//a.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> a1 = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">import</span> &#123; b1, b2 &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./b&quot;</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(b1, b2, <span class="hljs-string">&quot;a.js&quot;</span>);<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> a2 = <span class="hljs-number">11</span>;<br><br><span class="hljs-comment">//b.js</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> b1 = <span class="hljs-number">2</span>;<br><span class="hljs-keyword">import</span> &#123; a1, a2 &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./a&quot;</span>;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a1, a2, <span class="hljs-string">&quot;b.js&quot;</span>);<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> b2 = <span class="hljs-number">22</span>;<br><br><span class="hljs-comment">//main.js</span><br><span class="hljs-keyword">import</span> &#123; a1, a2 &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./a&quot;</span>;<br><span class="hljs-keyword">import</span> &#123; b1, b2 &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./b&quot;</span>;<br></code></pre></div></td></tr></table></figure>


<p>　　刚开始我们肯定会想当然的以为<code>b.js</code>中打印的是1和undefined，因为<code>a.js</code>只加载了第一个export；但是打印结果后，<code>b.js</code>中两个都是undefined，这是因为import有提升效果。</p>
<h1 id="区别总结"><a href="#区别总结" class="headerlink" title="区别总结"></a>区别总结</h1><p>　　通过上面我们对CommonJS规范和ES6规范的比较，我们总结一下两者的区别：</p>
<ul>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<li>CommonJS模块是运行时加载，ES6模块是编译时输出接口</li>
<li>CommonJS模块输出的是一个值的复制，ES6模块输出的是值的引用</li>
<li>CommonJS加载的是整个模块，即将所有的方法全部加载进来，ES6可以单独加载其中的某个方法</li>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<li>CommonJS中<code>this</code>指向当前模块，ES6中<code>this</code>指向undefined</li>
<li>CommonJS默认非严格模式，ES6的模块自动采用严格模式</li>
</ul>

            </div>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/programing/">编程</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/FrontEnd/">前端</a>
                    
                      <a class="hover-with-bg" href="/tags/Interview/">面试</a>
                    
                      <a class="hover-with-bg" href="/tags/Modularization/">模块化</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本网所有内容文字和图片，版权均属谢小飞所有，任何媒体、网站或个人未经本网协议授权不得转载、链接、转贴或以其他方式复制发布/发表。如需转载请关注公众号【前端壹读】后回复【转载】。
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/01/28/Package-Tool-Compare.html">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">深入对比Webpack、Parcel、Rollup打包工具的不同</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/12/16/DefineProperty-Proxy.html">
                        <span class="hidden-mobile">深入学习Object.defineProperty和Proxy</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createScript('https://xieyufei.com/npm/waline@1.6.0/Waline.min.js', function() {
        var options = Object.assign(
          {"serverURL":"https://comment.xieyufei.com","placeholder":"说点什么","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":true,"avatarCDN":"","avatarForce":false,"requiredFields":[],"emojiCDN":null,"emojiMaps":null,"anonymous":null,"appId":"dUHCmA1MmCKBNcTMG9KBopvL-MdYXbMMI","appKey":"33GvkVfTefXyelQRBTXNgEn6"},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        new Waline(options);
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="javascript:; target="_blank" rel="nofollow noopener"><span>We</span></a> <i class="iconfont icon-love"></i> <a href="https://xieyufei.com" target="_blank" rel="nofollow noopener"><span>谢小飞</span></a> <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  

  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        苏ICP备2024128889号-1
      </a>
    </span>
    
  </div>


  
    <!-- cnzz Analytics Icon -->
    <span id="cnzz_stat_icon_1260607518" style="display: none"></span>
  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://xieyufei.com/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://xieyufei.com/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://xieyufei.com/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://xieyufei.com/npm/bootstrap/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://xieyufei.com/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://xieyufei.com/npm/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://xieyufei.com/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://xieyufei.com/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>






  <script  src="https://xieyufei.com/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?466240fe55764d8ee20bd7f43c5e8b26";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  
    <!-- cnzz Analytics -->
    <script defer src="//s4.cnzz.com/z_stat.php?id=1260607518&show=pic"
            type="text/javascript"></script>
  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
