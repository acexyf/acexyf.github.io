

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.ico">
  <link rel="icon" href="/img/favicon.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="　　在学习了RN的样式、组件和路由之后，我们就可以来尝试自己开发一款我们自己的App，本文我们结合实际生活中的需要，从零开始实战开发一个App，开发期间也遇到了大大小小的坑，分享给大家希望帮助大家规避。">
  <meta name="author" content="Corner">
  <meta name="keywords" content="Corner">
  
  <title>React Native实战之安全密码箱 - 谢小飞的博客</title>

  <link  rel="stylesheet" href="https://xieyufei.com/npm/bootstrap/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://xieyufei.com/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://xieyufei.com/npm/highlight.js@10.7.2/styles/vs2015.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://xieyufei.com/npm/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"xieyufei.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"466240fe55764d8ee20bd7f43c5e8b26","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":1260607518,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/title.js" ></script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="谢小飞的博客" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>谢小飞的博客</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-pen"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-friends"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" target="_blank" rel="noopener" href="https://gallery.xieyufei.com/">
                <i class="iconfont icon-link-fill"></i>
                创意
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/bookshelf/">
                <i class="iconfont icon-books"></i>
                书架
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('//xieyufei.com/blog/bg_small.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="React Native实战之安全密码箱">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-08-28 13:14" pubdate>
        2022年8月28日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      4.8k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      68
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      
<style>
  .prevent_reptile{
    display: none;
  }
</style>
<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">React Native实战之安全密码箱</h1>
            
            <div class="markdown-body">
              <p>　　在学习了RN的样式、组件和路由之后，我们就可以来尝试自己开发一款我们自己的App，本文我们结合实际生活中的需要，从零开始实战开发一个App，开发期间也遇到了大大小小的坑，分享给大家希望帮助大家规避。</p>
<span id="more"></span>


<h1 id="项目源起"><a href="#项目源起" class="headerlink" title="项目源起"></a>项目源起</h1><p>　　我们在浏览网站或者App时经常会注册各种各样的账号，手机自带的的密码保险箱功能只能保存App的密码，不能保存网页的；不同网站的注册账号和密码的规则还不一样，因此我们的需求也很简单，记录下每个网站或App注册的账号密码即可；笔者之前在应用市场下载过某密码箱的App，如下：</p>
<p><img src="/images/React-Native-Safebox/origin.jpg" srcset="/img/loading.gif" lazyload alt="某密码箱"></p>
<p>　　但是将重要的密码保存在别人的App上，尤其是涉及到自己隐私的密码，总觉得有些不放心，其实主要是这破App还开始收费了；因此我们可以利用之前学习的RN知识来开发一款自用的密码保险箱，既安全可靠又物美价廉，说干就干。</p>
<h1 id="项目搭建"><a href="#项目搭建" class="headerlink" title="项目搭建"></a>项目搭建</h1><p>　　我们首先来搭建项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">react-native init rnSafeBox<br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>


<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　这里RN的第一个小坑来了，RN的版本已经到了0.68以上，它强制使用JDK 11进行Android build；我们看下0.68版本最低要求：</p>
<ul>
<li>Node &gt;= 14版本</li>
<li>java jdk &gt;= 11版本</li>
</ul>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<p>　　但笔者装的版本比较早，是JDK1.8，因此我们搭建项目时需要留意自己的JDK版本；我们可以加上<code>--version</code>来指定RN的版本</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">react-native init rnSafeBox --version 0.67.0<br></code></pre></div></td></tr></table></figure>


<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　搭建后，我们加入常用的一些依赖，如图标和路由导航，这里不再赘述了，需要的小伙伴可以看下这篇文章：<a href="https://xieyufei.com/2022/07/22/React-Native-Router.html">深入学习React Native之路由导航</a>。组件库的话，我们选择了<a href="mailto:&#x4e;&#x61;&#x74;&#105;&#x76;&#x65;&#x42;&#x61;&#x73;&#x65;&#64;&#x33;&#46;&#x34;&#x2e;&#x78;">&#x4e;&#x61;&#x74;&#105;&#x76;&#x65;&#x42;&#x61;&#x73;&#x65;&#64;&#x33;&#46;&#x34;&#x2e;&#x78;</a>，它的组件较为丰富且全面：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">yarn add native-base react-native-svg@12.1.1 react-native-safe-area-context@3.3.2<br></code></pre></div></td></tr></table></figure>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>


<p>　　我们在项目下新建src目录作为我们代码的主要目录，然后建立以下结构：</p>
<figure class="highlight 1c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs 1c"><span class="hljs-string">|- src</span><br>    <span class="hljs-string">|- router</span><br>        <span class="hljs-string">|- index.js</span><br>    <span class="hljs-string">|- utils</span><br>        <span class="hljs-string">|- index.js</span><br>        <span class="hljs-string">|- storage.js</span><br>    <span class="hljs-string">|- views</span><br>        <span class="hljs-string">|- Login</span><br>        <span class="hljs-string">|- Home</span><br>        <span class="hljs-string">|- Passwd</span><br>        <span class="hljs-string">|- Change</span><br></code></pre></div></td></tr></table></figure>

<p>　　router存放我们的路由组件，这里由于不需要复杂的选项卡导航，我们直接使用堆栈导航即可；我们首先改造入口的<code>App.js</code>，加入NativeBase和导航的Provider容器：</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">NativeBaseProvider</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;native-base&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">NavigationContainer</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@react-navigation/native&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./src/router/index&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">App</span> = (<span class="hljs-params"></span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SafeAreaProvider</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">NavigationContainer</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">NativeBaseProvider</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">NativeBaseProvider</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">NavigationContainer</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">SafeAreaProvider</span>&gt;</span></span><br>  );<br>&#125;;<br></code></pre></div></td></tr></table></figure>

<p>　　给我们的路由router/index.js导入页面：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Stack.Navigator</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Stack.Screen</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Login&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">component</span>=<span class="hljs-string">&#123;Login&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">options</span>=<span class="hljs-string">&#123;&#123;headerShown:</span> <span class="hljs-attr">false</span>&#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Stack.Screen</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Home&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">component</span>=<span class="hljs-string">&#123;Home&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">options</span>=<span class="hljs-string">&#123;&#123;title:</span> &#x27;<span class="hljs-attr">首页</span>&#x27;&#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Stack.Screen</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Passwd&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">component</span>=<span class="hljs-string">&#123;Passwd&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">options</span>=<span class="hljs-string">&#123;&#123;title:</span> &#x27;<span class="hljs-attr">密码</span>&#x27;&#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Stack.Screen</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Change&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">component</span>=<span class="hljs-string">&#123;Change&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">options</span>=<span class="hljs-string">&#123;&#123;title:</span> &#x27;<span class="hljs-attr">修改入口密码</span>&#x27;&#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        /&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">Stack.Navigator</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>


<h2 id="主要页面"><a href="#主要页面" class="headerlink" title="主要页面"></a>主要页面</h2><p>　　首先我们来看下登录页面，登录页面比较简单，我们只需要一个输入框和确定按钮（省略其他组件代码）：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">Sae</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-native-textinput-effects&#x27;</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Login</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">super</span>(props);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">now</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-comment">// storage中的密码</span><br>      <span class="hljs-attr">pwd</span>: <span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-comment">// 用户输入的密码</span><br>    &#125;;<br>  &#125;<br>  <span class="hljs-title function_">clickSubmit</span>(<span class="hljs-params"></span>) &#123;&#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123;pwd&#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">return</span> (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Sae</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;pwd&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">label</span>=<span class="hljs-string">&#123;</span>&#x27;<span class="hljs-attr">入口密码</span>&#x27;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">secureTextEntry</span>=<span class="hljs-string">&#123;true&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">iconClass</span>=<span class="hljs-string">&#123;FontAwesomeIcon&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">iconName</span>=<span class="hljs-string">&#123;</span>&#x27;<span class="hljs-attr">lock</span>&#x27;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">        <span class="hljs-attr">onChangeText</span>=<span class="hljs-string">&#123;value</span> =&gt;</span> this.setState(&#123;pwd: value&#125;)&#125;</span><br><span class="language-xml">    /&gt;</span><br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">onPress</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> this.clickSubmit()&#125;&gt;确定<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>    )<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>　　这里我们用到<code>react-native-textinput-effects</code>组件，这是一个用纯js实现不同的炫酷效果的textinput组件库，实现的输入框效果如下：</p>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<p><img src="/images/React-Native-Safebox/sae.gif" srcset="/img/loading.gif" lazyload alt="Sae效果"></p>
<p>　　其次是我们的首页，用来展示账号密码的列表：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">super</span>();<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">list</span>: [],<br>    &#125;;<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;styles.box&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">ScrollView</span>&gt;</span></span><br><span class="language-xml">          &#123;list.map((item, index) =&gt; &#123;</span><br><span class="language-xml">            return <span class="hljs-tag">&lt;<span class="hljs-name">ListItem</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&#123;item&#125;</span> <span class="hljs-attr">index</span>=<span class="hljs-string">&#123;index&#125;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ListItem</span>&gt;</span>;</span><br><span class="language-xml">          &#125;)&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">ScrollView</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;styles.fixedAddBtn&#125;</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#123;</span>&quot;<span class="hljs-attr">plus</span>&quot;&#125; <span class="hljs-attr">size</span>=<span class="hljs-string">&#123;30&#125;</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;#fff&quot;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>


<p>　　fixedAddBtn按钮用来点击跳转到新增账号密码的页面；我们将list中的每个数据封装成ListItem组件，方便后面进行动画效果的展示。效果如下：</p>
<p><img src="/images/React-Native-Safebox/home.png" srcset="/img/loading.gif" lazyload alt="首页"></p>
<p>　　然后是修改入口密码页面Change，它分为两种情况，如果已经设置过了，就进行修改；如果没有设置，则可以设置新的密码。</p>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Change</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; showOldPwd &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        &#123;showOldPwd &amp;&amp; (</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Sae</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">label</span>=<span class="hljs-string">&#123;</span>&quot;<span class="hljs-attr">请输入旧入口密码</span>&quot;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">onChangeText</span>=<span class="hljs-string">&#123;(value)</span> =&gt;</span> this.setState(&#123; oldPwd: value &#125;)&#125;</span><br><span class="language-xml">          /&gt;</span><br><span class="language-xml">        )&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Sae</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">label</span>=<span class="hljs-string">&#123;</span>&quot;<span class="hljs-attr">新的入口密码</span>&quot;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChangeText</span>=<span class="hljs-string">&#123;(value)</span> =&gt;</span> this.setState(&#123; newPwd: value &#125;)&#125;</span><br><span class="language-xml">        /&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Sae</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">label</span>=<span class="hljs-string">&#123;</span>&quot;<span class="hljs-attr">请再次输入密码</span>&quot;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onChangeText</span>=<span class="hljs-string">&#123;(value)</span> =&gt;</span> this.setState(&#123; repeatPwd: value &#125;)&#125;</span><br><span class="language-xml">        /&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>确定<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p><img src="/images/React-Native-Safebox/change.png" srcset="/img/loading.gif" lazyload alt="修改入口密码"></p>
<p>　　最后是新增和编辑账号密码页面Passwd，它的部分代码如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Passwd</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">showSheet</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">isVisible</span>: <span class="hljs-literal">true</span>,<br>    &#125;);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;styles.box&#125;</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">TouchableWithoutFeedback</span> <span class="hljs-attr">onPress</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> this.showSheet()&#125;&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>密码类型<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">            <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> <span class="hljs-attr">isDisabled</span>=<span class="hljs-string">&#123;true&#125;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;pwdType&#125;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请选择密码类型&quot;</span> /&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">TouchableWithoutFeedback</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>用户名<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Input</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;username&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入用户名&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">onChangeText</span>=<span class="hljs-string">&#123;(value)</span> =&gt;</span> this.setState(&#123; username: value &#125;)&#125;</span><br><span class="language-xml">          /&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>密码<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Input</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">value</span>=<span class="hljs-string">&#123;password&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入密码&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">            <span class="hljs-attr">onChangeText</span>=<span class="hljs-string">&#123;(value)</span> =&gt;</span> this.setState(&#123; password: value &#125;)&#125;</span><br><span class="language-xml">          /&gt;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>


<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<p>　　这里除了密码类型，其他字段（用户名、密码、标题、网址）等都是输入框，直接输入即可；密码类型点击后呈现下拉框，我们这里使用native-base的<code>Actionsheet</code>组件：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Actionsheet</span> isOpen=&#123;isVisible&#125; onClose=&#123;<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">closeSheet</span>()&#125;&gt;<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Actionsheet.Content</span>&gt;</span></span><br><span class="language-xml">    &#123;list.map((el, index) =&gt; &#123;</span><br><span class="language-xml">      return (</span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Actionsheet.Item</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">key</span>=<span class="hljs-string">&#123;index&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">          <span class="hljs-attr">onPress</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> this.clickTypeItem(el, index)&#125;</span><br><span class="language-xml">        &gt;</span><br><span class="language-xml">          &#123;el.name&#125;</span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Actionsheet.Item</span>&gt;</span></span><br><span class="language-xml">      );</span><br><span class="language-xml">    &#125;)&#125;</span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">Actionsheet.Content</span>&gt;</span></span><br>&lt;/<span class="hljs-title class_">Actionsheet</span>&gt;;<br></code></pre></div></td></tr></table></figure>

<p>　　Actionsheet效果如下：</p>
<p><img src="/images/React-Native-Safebox/passwd.gif" srcset="/img/loading.gif" lazyload alt="Passwd页面效果"></p>
<h2 id="路由改造"><a href="#路由改造" class="headerlink" title="路由改造"></a>路由改造</h2><p>　　我们的页面框架已经基本搭建完成了，我们对路由组件进行一些改造，对登录状态进行区分；在登录成功后才能进入首页及后续页面，否则只能展示登录页面：</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Stack</span>.<span class="hljs-property">Navigator</span>&gt;<br>  &#123;isLogin ? (<br>    <span class="language-xml"><span class="hljs-tag">&lt;&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;<span class="hljs-name">Stack.Screen</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Home&quot;</span> <span class="hljs-attr">component</span>=<span class="hljs-string">&#123;Home&#125;</span> <span class="hljs-attr">options</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">title:</span> &quot;<span class="hljs-attr">首页</span>&quot; &#125;&#125; /&gt;</span></span><br><span class="language-xml">      &#123;/* 以及其他页面 */&#125;</span><br><span class="language-xml">    <span class="hljs-tag">&lt;/&gt;</span></span><br>  ) : (<br>    <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Stack.Screen</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Login&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">component</span>=<span class="hljs-string">&#123;Login&#125;</span></span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">options</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">headerShown:</span> <span class="hljs-attr">false</span> &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">    /&gt;</span></span><br>  )&#125;<br>&lt;/<span class="hljs-title class_">Stack</span>.<span class="hljs-property">Navigator</span>&gt;<br></code></pre></div></td></tr></table></figure>

<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>

<p>　　我们设置初始化页面为登录页，同时登录页不需要展示header；再给其他页面的header设置统一的背景颜色和字体颜色：</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">Stack</span>.<span class="hljs-property">Navigator</span><br>  initialRouteName=<span class="hljs-string">&quot;Login&quot;</span><br>  screenOptions=&#123;&#123;<br>    <span class="hljs-attr">headerStyle</span>: &#123;<br>      <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">&#x27;#128574&#x27;</span>,<br>    &#125;,<br>    <span class="hljs-attr">headerTintColor</span>: <span class="hljs-string">&#x27;#fff&#x27;</span>,<br>    <span class="hljs-attr">headerTitleStyle</span>: &#123;<br>      <span class="hljs-attr">fontWeight</span>: <span class="hljs-string">&#x27;normal&#x27;</span>,<br>    &#125;,<br>  &#125;&#125;&gt;<br>&lt;/<span class="hljs-title class_">Stack</span>.<span class="hljs-property">Navigator</span>&gt;<br></code></pre></div></td></tr></table></figure>


<p>　　现在我们需要通过<code>isLogin</code>变量来控制路由的变化，由于登录操作时在登录页面判断的，我们可以通过全局的event bus来进行监听，在页面销毁时不要忘记移除监听事件：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> bus <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../utils/bus.js&#x27;</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Router</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">getLogin</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">getLogin</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);<br>  &#125;<br>  <span class="hljs-title function_">getLogin</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123;<br>      <span class="hljs-attr">isLogin</span>: <span class="hljs-literal">true</span>,<br>    &#125;);<br>  &#125;<br>  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>    bus.<span class="hljs-title function_">addListener</span>(<span class="hljs-string">&quot;login&quot;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">getLogin</span>);<br>  &#125;<br>  <span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"></span>) &#123;<br>    bus.<span class="hljs-title function_">removeListener</span>(<span class="hljs-string">&quot;login&quot;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">getLogin</span>);<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>　　<code>bus.js</code>的代码也很简单，直接调用events库：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123;<span class="hljs-title class_">EventEmitter</span>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;events&#x27;</span>;<br><span class="hljs-keyword">const</span> eventBus = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> eventBus;<br></code></pre></div></td></tr></table></figure>


<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>

<h2 id="存取数据"><a href="#存取数据" class="headerlink" title="存取数据"></a>存取数据</h2><p>　　数据的存和取是我们这个App的核心功能，我们用到<code>Async Storage</code>这个库，它是一个给RN进行数据存储的依赖库，首先进行安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">npm install @react-native-async-storage/async-storage<br><span class="hljs-comment"># or</span><br>yarn add @react-native-async-storage/async-storage<br></code></pre></div></td></tr></table></figure>


<p>　　它的用法也很简单，和LocalStorage的API有点类似，都是以字符串形式存储键和值，我们把它封装到<code>utils/storage.js</code>，方便调用：</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">AsyncStorage</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@react-native-async-storage/async-storage&#x27;</span>;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">key = <span class="hljs-string">&#x27;&#x27;</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">`@storage_<span class="hljs-subst">$&#123;key&#125;</span>`</span>);<br>  &#125; <span class="hljs-keyword">catch</span> (e)  &#123;<span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>; &#125;<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">storeData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">key = <span class="hljs-string">&#x27;&#x27;</span>, value = <span class="hljs-string">&#x27;&#x27;</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">`@storage_<span class="hljs-subst">$&#123;key&#125;</span>`</span>, value);<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;&#125;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">storeObjectData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">key, obj</span>) =&gt; &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">&#x27;object&#x27;</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">&#x27;obj is not a object&#x27;</span>);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">`@storage_<span class="hljs-subst">$&#123;key&#125;</span>`</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj));<br>  &#125; <span class="hljs-keyword">catch</span> (e) &#123;&#125;<br>&#125;;<br><span class="hljs-keyword">const</span> <span class="hljs-title function_">getObjectData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">key = <span class="hljs-string">&#x27;&#x27;</span></span>) =&gt; &#123;<br>  <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">AsyncStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">`@storage_<span class="hljs-subst">$&#123;key&#125;</span>`</span>);<br>  <span class="hljs-keyword">if</span> (res) &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(res);<br>    &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>      <span class="hljs-keyword">return</span> &#123;&#125;;<br>    &#125;<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123;&#125;;<br>  &#125;<br>&#125;;<br></code></pre></div></td></tr></table></figure>

<p>　　我们封装了两组APi，一组是直接存取值的，另一组是可以存取对象的。这样，我们在登录页时，先把存储的入口密码<code>entrance</code>取出来，如果不存在，则直接进入首页；如果存在，在下面点击登录按钮时就将用户输入的值进行比较即可：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; getData &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;../../utils/storage&quot;</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Login</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getStorage</span>();<br>  &#125;<br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getStorage</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> now = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getData</span>(<span class="hljs-string">&quot;entrance&quot;</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> now === <span class="hljs-string">&quot;string&quot;</span> &amp;&amp; now) &#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(&#123; now &#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// 没有设置入口密码，直接进入</span><br>      bus.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&quot;login&quot;</span>);<br>    &#125;<br>  &#125;<br>  <span class="hljs-title function_">clickSubmit</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; pwd, now &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">if</span> (!pwd) &#123;<br>      <span class="hljs-title function_">showToast</span>(<span class="hljs-string">&quot;请输入入口密码&quot;</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (pwd !== now) &#123;<br>      <span class="hljs-title function_">showToast</span>(<span class="hljs-string">&quot;入口密码不正确&quot;</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">// 登录成功</span><br>    bus.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&quot;login&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>

<p>　　在设置入口密码的Change页面，我们对新旧密码进行一系列校验，然后直接保存到storage中即可，这里不再赘述了。</p>
<p>　　在首页，我们在<code>updateList</code>函数中将storage中保存的每一条密码取出来放到list中进行展示，但是在新增或者编辑storage中的密码之后，需要及时重新调用这个函数更新list数组，我们在<a href="https://xieyufei.com/2022/07/22/React-Native-Router.html">RN路由导航</a>中的导航的生命周期中说过，可以监听<code>focus</code>事件来判断页面是否重新聚焦：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-comment">// 更新list数组</span><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">updateList</span>(<span class="hljs-params"></span>) &#123;&#125;<br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateList</span>();<br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_focus</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">props</span>.<span class="hljs-property">navigation</span>.<span class="hljs-title function_">addListener</span>(<span class="hljs-string">&quot;focus&quot;</span>, <span class="hljs-keyword">async</span> () =&gt; &#123;<br>      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateList</span>();<br>    &#125;);<br>  &#125;<br>  <span class="hljs-title function_">componentWillUnrmount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_focus</span>();<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>


<h1 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h1><p>　　我们整个App的存储和读取的功能已经基本完成，基本功能也能够使用了，下面对界面和功能进行一些优化。</p>
<h2 id="新增按钮加阴影"><a href="#新增按钮加阴影" class="headerlink" title="新增按钮加阴影"></a>新增按钮加阴影</h2><p>　　在原版的App中，新增按钮有一个阴影的效果，阴影效果也是一个很常见的需求；在CSS3中，我们可以直接通过<code>box-shadow</code>属性实现，在RN中iOS平台支持以下shadow属性：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx">&lt;<span class="hljs-title class_">View</span><br>  style=&#123;&#123;<br>    <span class="hljs-attr">shadowOffset</span>: &#123;<br>      <span class="hljs-attr">width</span>: <span class="hljs-number">10</span>,<br>      <span class="hljs-attr">height</span>: <span class="hljs-number">10</span>,<br>    &#125;,<br>    <span class="hljs-attr">shadowOpacity</span>: <span class="hljs-number">0.8</span>,<br>    <span class="hljs-attr">shadowRadius</span>: <span class="hljs-number">1.5</span>,<br>  &#125;&#125;<br>/&gt;<br></code></pre></div></td></tr></table></figure>

<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>

<p>　　在安卓端可以通过<code>elevation</code>属性，但是两者表现形式差别很大；因此我们引入第三方的react-native-shadow，它是利用react-native-svg画出svg阴影，因此两端效果比较一致；我们同时安装这两个依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">yarn add react-native-shadow<br>yarn add react-native-svg<br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>


<p>　　然后给fixedAddBtn套一层BoxShadow组件：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">BoxShadow</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-native-shadow&quot;</span>;<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">BoxShadow</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">setting</span>=<span class="hljs-string">&#123;&#123;</span></span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">width:</span> <span class="hljs-attr">30</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">height:</span> <span class="hljs-attr">30</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">color:</span> &quot;#<span class="hljs-attr">000</span>&quot;,</span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">border:</span> <span class="hljs-attr">20</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">radius:</span> <span class="hljs-attr">15</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">opacity:</span> <span class="hljs-attr">0.1</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">x:</span> <span class="hljs-attr">0</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">y:</span> <span class="hljs-attr">25</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">    <span class="hljs-attr">style:</span> &#123;</span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">justifyContent:</span> &quot;<span class="hljs-attr">center</span>&quot;,</span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">alignItems:</span> &quot;<span class="hljs-attr">center</span>&quot;,</span></span><br><span class="hljs-tag"><span class="language-xml">      <span class="hljs-attr">flex:</span> <span class="hljs-attr">1</span>,</span></span><br><span class="hljs-tag"><span class="language-xml">    &#125;,</span></span><br><span class="hljs-tag"><span class="language-xml">  &#125;&#125;</span></span><br><span class="hljs-tag"><span class="language-xml">&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;styles.fixedAddBtn&#125;</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&#123;</span>&quot;<span class="hljs-attr">plus</span>&quot;&#125; <span class="hljs-attr">size</span>=<span class="hljs-string">&#123;30&#125;</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;#fff&quot;</span> /&gt;</span></span><br><span class="language-xml">  <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">BoxShadow</span>&gt;</span></span>;<br></code></pre></div></td></tr></table></figure>


<h2 id="复制功能"><a href="#复制功能" class="headerlink" title="复制功能"></a>复制功能</h2><p>　　我们点击复制按钮可以直接复制账号或者密码到剪切板；RN已经将Clipboard功能从核心代码中分离出来，我们需要安装一下第三方的模块：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">yarn add @react-native-clipboard/clipboard<br></code></pre></div></td></tr></table></figure>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>

<p>　　调用<code>Clipboard.setString</code>，复制到剪切板，调用<code>await Clipboard.getString()</code>获取剪切板的内容；我们这边使用setString即可：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Clipboard</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@react-native-clipboard/clipboard&quot;</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-title function_">clickCopy</span>(<span class="hljs-params">text</span>) &#123;<br>    <span class="hljs-title class_">Clipboard</span>.<span class="hljs-title function_">setString</span>(text);<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>用户名：<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">TouchableOpacity</span> <span class="hljs-attr">onPress</span>=<span class="hljs-string">&#123;()</span> =&gt;</span> this.clickCopy(username)&#125;&gt;</span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>&#123;username&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">TouchableOpacity</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>



<h2 id="指纹识别登录"><a href="#指纹识别登录" class="headerlink" title="指纹识别登录"></a>指纹识别登录</h2><p>　　现在的智能手机一般都带有指纹识别的传感器，我们可以利用指纹模块来方便用户登录；React Native Fingerprint Scanner是一个RN库，用于使用指纹对用户进行身份验证；它提供了一个默认视图，提示用户将手指放在传感器上进行扫描。</p>
<p>　　我们根据<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/react-native-fingerprint-scanner#installation">安装教程</a>安装该依赖后，发现它的文档看起来很多，很唬人，但是核心的API只有两个，首先是<code>isSensorAvailable</code>，用来判断传感器是否可用，如果手机没有设置指纹则不可用，该函数直接报错，因此通过try/catch进行包装：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Login</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-comment">// 判断指纹传感器是否可用</span><br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">checkSensorsAvailable</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> flag = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">let</span> biometryType = <span class="hljs-keyword">await</span> <span class="hljs-title class_">FingerprintScanner</span>.<span class="hljs-title function_">isSensorAvailable</span>();<br>      flag = <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (error) &#123;&#125;<br>    <span class="hljs-keyword">return</span> flag;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>

<p>　　在安卓端biometryType值如果可用的话为Biometrics，iOS端为’Touch ID’和’Face ID’，目前我们只考虑安卓端；判断后我们就真正可以调用指纹模块了，<code>authenticate</code>函数自动唤起指纹识别模块的模态框，我们填入title和description一些描述文案来引导用户：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Login</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">scanAuth</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">let</span> flag = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title class_">FingerprintScanner</span>.<span class="hljs-title function_">authenticate</span>(&#123;<br>        <span class="hljs-attr">title</span>: <span class="hljs-string">&quot;指纹登录&quot;</span>,<br>        <span class="hljs-attr">description</span>: <span class="hljs-string">&quot;请触摸指纹传感器&quot;</span>,<br>        <span class="hljs-attr">cancelButton</span>: <span class="hljs-string">&quot;取消&quot;</span>,<br>      &#125;);<br>      <span class="hljs-keyword">if</span> (res === <span class="hljs-literal">true</span>) &#123;<br>        flag = <span class="hljs-literal">true</span>;<br>      &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (error) &#123;&#125;<br>    <span class="hljs-keyword">return</span> flag;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>

<p>　　我们在页面初始化时，如果设置了入口密码，则进行指纹识别校验，自动弹出模态框，验证成功后跳转首页，同时不要忘了在页面销毁时调用<code>release</code>释放指纹模块的资源：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Login</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Component</span> &#123;<br>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-comment">// 当前已经设置了密码</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">now</span>) &#123;<br>      <span class="hljs-keyword">let</span> available = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">checkSensorsAvailable</span>();<br>      <span class="hljs-keyword">if</span> (available) &#123;<br>        <span class="hljs-keyword">let</span> auth = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">scanAuth</span>();<br>        <span class="hljs-keyword">if</span> (auth) &#123;<br>          bus.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&quot;login&quot;</span>);<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-comment">// 释放资源</span><br>  componentWillUnmount = <span class="hljs-function">() =&gt;</span> &#123;<br>    <span class="hljs-title class_">FingerprintScanner</span>.<span class="hljs-title function_">release</span>();<br>  &#125;;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>

<p>　　指纹识别效果如下：</p>
<p><img src="/images/React-Native-Safebox/fail.png" srcset="/img/loading.gif" lazyload alt="指纹识别"></p>
<p>　　放错图了，应该是下面这张：</p>
<p><img src="/images/React-Native-Safebox/fingerprint.jpg" srcset="/img/loading.gif" lazyload alt="指纹识别"></p>
<h2 id="箭头添加动效"><a href="#箭头添加动效" class="headerlink" title="箭头添加动效"></a>箭头添加动效</h2><p>　　我们在首页的列表展开时，给小箭头一个旋转的动画效果；RN中提供了Animated API来实现动画，可以简洁的实现各种动画和交互方式，并且具备极高的性能，我们从RN中导出模块：</p>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Animated</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;react-native&quot;</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ListItem</span> &#123;<br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> rotateDeg = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animated</span>.<span class="hljs-title class_">Value</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = &#123;<br>      <span class="hljs-attr">rotateDeg</span>: rotateDeg,<br>    &#125;;<br>  &#125;<br>  <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">const</span> &#123; rotateDeg &#125; = <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;<br>    <span class="hljs-keyword">const</span> rotate = rotateDeg.<span class="hljs-title function_">interpolate</span>(&#123;<br>      <span class="hljs-attr">inputRange</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>],<br>      <span class="hljs-attr">outputRange</span>: [<span class="hljs-string">&quot;0deg&quot;</span>, <span class="hljs-string">&quot;180deg&quot;</span>],<br>    &#125;);<br>    <span class="hljs-keyword">return</span> (<br>      <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Animated.View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#123;&#123;</span> <span class="hljs-attr">transform:</span> [&#123; <span class="hljs-attr">rotate:</span> <span class="hljs-attr">rotate</span> &#125;] &#125;&#125;&gt;</span></span><br><span class="language-xml">          <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;up&quot;</span> <span class="hljs-attr">size</span>=<span class="hljs-string">&#123;20&#125;</span> <span class="hljs-attr">color</span>=<span class="hljs-string">&quot;#333&quot;</span> /&gt;</span></span><br><span class="language-xml">        <span class="hljs-tag">&lt;/<span class="hljs-name">Animated.View</span>&gt;</span></span><br><span class="language-xml">      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span><br>    );<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>


<p>　　我们首先使用new Animated.Value创建一个值，在render函数中使用了一个interpolate()插值函数，用于将输入值范围转换为输出值范围，这里是将[0, 1]输入转为[“0deg”, “180deg”]输出。</p>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<figure class="highlight jsx"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jsx"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ANIMATE_DURATION</span> = <span class="hljs-number">200</span>;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ListItem</span> &#123;<br>  <span class="hljs-title function_">clickListItem</span>(<span class="hljs-params">item, index</span>) &#123;<br>    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">toggle</span>) &#123;<br>      <span class="hljs-comment">// 当前是打开状态</span><br>      <span class="hljs-title class_">Animated</span>.<span class="hljs-title function_">timing</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">rotateDeg</span>, &#123;<br>        <span class="hljs-attr">toValue</span>: <span class="hljs-number">0</span>,<br>        <span class="hljs-attr">duration</span>: <span class="hljs-variable constant_">ANIMATE_DURATION</span>,<br>        <span class="hljs-attr">useNativeDriver</span>: <span class="hljs-literal">true</span>,<br>      &#125;).<span class="hljs-title function_">start</span>();<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// 当前是关闭状态</span><br>      <span class="hljs-title class_">Animated</span>.<span class="hljs-title function_">timing</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">rotateDeg</span>, &#123;<br>        <span class="hljs-attr">toValue</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-attr">duration</span>: <span class="hljs-variable constant_">ANIMATE_DURATION</span>,<br>        <span class="hljs-attr">useNativeDriver</span>: <span class="hljs-literal">true</span>,<br>      &#125;).<span class="hljs-title function_">start</span>();<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>


<p>　　当点击展开列表元素时，调用<code>Animated.timing</code>，使得值按照过渡曲线随时间变化而变化，duration设置动画的执行时间，最终效果如下：</p>
<p><img src="/images/React-Native-Safebox/animation.gif" srcset="/img/loading.gif" lazyload alt="箭头动画效果"></p>
<h1 id="打包及一些问题"><a href="#打包及一些问题" class="headerlink" title="打包及一些问题"></a>打包及一些问题</h1><p>　　我们的App开发完成后，就需要进行打包了，这里简单的看下笔者遇到的一些坑，希望能够让大家在开发时规避类似的坑。</p>
<h2 id="打包apk后运行闪退"><a href="#打包apk后运行闪退" class="headerlink" title="打包apk后运行闪退"></a>打包apk后运行闪退</h2><p>　　我们开发时没有问题，但打包成apk文件后，兴冲冲的安装，结果现实泼了一盆冷水，运行直接闪退；搜索一番后，说是index.android.bundle文件没正常生成所致，我们运行一下打包命令，首先进行js文件的打包，再运行<code>./gradlew assembleRelease</code>打包：</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">react-native bundle --platform android --dev <span class="hljs-literal">false</span> --entry-file index.js --bundle-output android/app/src/main/assets/index.android.bundle  --assets-dest android/app/src/main/res/<br></code></pre></div></td></tr></table></figure>




<h2 id="Duplicate-resources"><a href="#Duplicate-resources" class="headerlink" title="Duplicate resources"></a>Duplicate resources</h2><p>　　打包时还会遇到Duplicate resources报错，翻译过来就是重复资源：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs asciidoc"><span class="hljs-meta">:app:mergeReleaseResources</span> FAILED<br><br>Execution failed for task <span class="hljs-emphasis">&#x27;:app:mergeReleaseResources&#x27;</span>.<br><br>/android/app/build/generated/res/react/release/drawable-XXXX： Error: Duplicate resources<br></code></pre></div></td></tr></table></figure>

<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
<p>　　网上说是打包问题，打开node_modules/react-native/react.gradle文件，在doFirst代码段后面新增以下代码：</p>
<figure class="highlight gradle"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs gradle"><span class="hljs-keyword">doFirst</span>&#123; ... &#125;<br># 新增<br><span class="hljs-keyword">doLast</span> &#123;<br>    <span class="hljs-keyword">def</span> moveFunc = &#123; resSuffix -&gt;<br>        <span class="hljs-keyword">File</span> originalDir = <span class="hljs-keyword">file</span>(<span class="hljs-string">&quot;$&#123;resourcesDir&#125;/drawable-$&#123;resSuffix&#125;&quot;</span>)<br>        <span class="hljs-keyword">if</span> (originalDir.exists()) &#123;<br>            <span class="hljs-keyword">File</span> destDir = <span class="hljs-keyword">file</span>(<span class="hljs-string">&quot;$buildDir/../src/main/res/drawable-$&#123;resSuffix&#125;&quot;</span>)<br>            <span class="hljs-keyword">ant</span>.move(<span class="hljs-keyword">file</span>: originalDir, tofile: destDir)<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">def</span> moveRawFunc = &#123; dir -&gt;<br>        <span class="hljs-keyword">File</span> originalDir = <span class="hljs-keyword">file</span>(<span class="hljs-string">&quot;$&#123;resourcesDir&#125;/$&#123;dir&#125;&quot;</span>)<br>        <span class="hljs-keyword">if</span> (originalDir.exists()) &#123;<br>            <span class="hljs-keyword">File</span> destDir = <span class="hljs-keyword">file</span>(<span class="hljs-string">&quot;$buildDir/../src/main/res/$&#123;dir&#125;&quot;</span>)<br>            <span class="hljs-keyword">ant</span>.move(<span class="hljs-keyword">file</span>: originalDir, tofile: destDir)<br>        &#125;<br>    &#125;<br><br>    moveFunc.curry(<span class="hljs-string">&quot;ldpi&quot;</span>).<span class="hljs-keyword">call</span>()<br>    moveFunc.curry(<span class="hljs-string">&quot;mdpi&quot;</span>).<span class="hljs-keyword">call</span>()<br>    moveFunc.curry(<span class="hljs-string">&quot;hdpi&quot;</span>).<span class="hljs-keyword">call</span>()<br>    moveFunc.curry(<span class="hljs-string">&quot;xhdpi&quot;</span>).<span class="hljs-keyword">call</span>()<br>    moveFunc.curry(<span class="hljs-string">&quot;xxhdpi&quot;</span>).<span class="hljs-keyword">call</span>()<br>    moveFunc.curry(<span class="hljs-string">&quot;xxxhdpi&quot;</span>).<span class="hljs-keyword">call</span>()<br>    moveRawFunc.curry(<span class="hljs-string">&quot;raw&quot;</span>).<span class="hljs-keyword">call</span>()<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>　　参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/facebook/react-native/issues/22234">https://github.com/facebook/react-native/issues/22234</a></li>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/52668524/react-native-error-duplicate-resources-assets-coming-in-some-screens-and-not-c/52767101#52767101">https://stackoverflow.com/questions/52668524/react-native-error-duplicate-resources-assets-coming-in-some-screens-and-not-c/52767101#52767101</a></li>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/47084810/react-native-android-duplicate-file-error-when-generating-apk">https://stackoverflow.com/questions/47084810/react-native-android-duplicate-file-error-when-generating-apk</a></li>
</ul>
<h2 id="Reanimated报错"><a href="#Reanimated报错" class="headerlink" title="Reanimated报错"></a>Reanimated报错</h2><p>　　react-native-reanimated依赖报错：</p>
<figure class="highlight livescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livescript">error: node_modules/react-<span class="hljs-keyword">native</span>-reanimated/src/index.ts: /Users/tomekzaw/RNOS/Issue3397/node_modules/react-<span class="hljs-keyword">native</span>-reanimated/src/index.ts: Export namespace should be first transformed <span class="hljs-keyword">by</span> `@babel/plugin-proposal-<span class="hljs-keyword">export</span>-namespace-<span class="hljs-keyword">from</span>`.<br>  <span class="hljs-number">5</span> | <span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./reanimated1&#x27;</span>;<br>  <span class="hljs-number">6</span> | <span class="hljs-keyword">export</span> * <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./reanimated2&#x27;</span>;<br>&gt; <span class="hljs-number">7</span> | <span class="hljs-keyword">export</span> * <span class="hljs-keyword">as</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./Animated&#x27;</span>;<br>    |        ^^^^^^^^^^^^<br></code></pre></div></td></tr></table></figure>

<p>　　打开babel配置文件babel.config.js，新增如下插件:</p>
<figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = &#123;<br>  <span class="hljs-attr">presets</span>: [<span class="hljs-string">&#x27;module:metro-react-native-babel-preset&#x27;</span>],<br>+  <span class="hljs-attr">plugins</span>: [<span class="hljs-string">&#x27;react-native-reanimated/plugin&#x27;</span>],<br>&#125;;<br></code></pre></div></td></tr></table></figure>

<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>

<p>　　参考：<a target="_blank" rel="noopener" href="https://github.com/software-mansion/react-native-reanimated/issues/3410">https://github.com/software-mansion/react-native-reanimated/issues/3410</a></p>
<h2 id="FingerprintScanner"><a href="#FingerprintScanner" class="headerlink" title="FingerprintScanner"></a>FingerprintScanner</h2><p>　　react-native-fingerprint-scanner打包时报如下错误：</p>
<figure class="highlight elixir"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs elixir"><span class="hljs-symbol">FAILURE:</span> <span class="hljs-title class_">Build</span> failed <span class="hljs-keyword">with</span> an exception.<br><br>* <span class="hljs-title class_">What</span> went <span class="hljs-symbol">wrong:</span><br><span class="hljs-title class_">Execution</span> failed <span class="hljs-keyword">for</span> task <span class="hljs-string">&#x27;:app:checkDebugAarMetadata&#x27;</span>.<br>&gt; <span class="hljs-title class_">Could</span> <span class="hljs-keyword">not</span> resolve all files <span class="hljs-keyword">for</span> configuration <span class="hljs-string">&#x27;:app:debugRuntimeClasspath&#x27;</span>.<br>   &gt; <span class="hljs-title class_">Could</span> <span class="hljs-keyword">not</span> find <span class="hljs-symbol">com.wei.android.lib:</span><span class="hljs-symbol">fingerprintidentify:</span><span class="hljs-number">1.2</span>.<span class="hljs-number">6</span>.<br>     <span class="hljs-title class_">Required</span> <span class="hljs-symbol">by:</span><br>         project <span class="hljs-symbol">:app</span> &gt; project <span class="hljs-symbol">:react-native-fingerprint-scanner</span><br></code></pre></div></td></tr></table></figure>


<p>　　build.gradle新增jcenter()</p>
<p><a class="prevent_reptile" href="https://www.xieyufei.com" style="font-size:24px" target="_blank" rel="noopener">谢小飞博客专用防爬虫链接，想要看最新的前端博客请点这里</a></p>
<p>　　参考：<a target="_blank" rel="noopener" href="https://github.com/hieuvp/react-native-fingerprint-scanner/issues/192">https://github.com/hieuvp/react-native-fingerprint-scanner/issues/192</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>　　我们的自研App到这里基本就结束了，该有的功能也都有了；当然在开发过程中也遇到了不少坑，好几个依赖包安装和运行中都出现了大大小小不同的问题，上面的bug列表只是列举了一些典型的问题；只要我们利用好Github和Stack Overflow，总能找到解决方案。</p>
<p><img src="/images/React-Native-Safebox/youxian.png" srcset="/img/loading.gif" lazyload alt="悠闲的"></p>
<p>　　有兴趣的小伙伴可以到<a target="_blank" rel="noopener" href="https://github.com/acexyf/rnSafeBox">Github</a>给个Star，有好的想法和改进建议也欢迎提给我；本App只将数据保存在本地，没有上传服务器，因此大家可以放心使用；如果想要体验，请在公众号【前端壹读】后台回复关键词<code>安全密码箱</code>即可获取App的安装包。</p>

            </div>
            <hr>
            <div>
<script>if(window.location.hostname.indexOf("xieyufei.com") === -1){ window.location.href = "https://xieyufei.com" }</script>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/programing/">编程</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/FrontEnd/">前端</a>
                    
                      <a class="hover-with-bg" href="/tags/Apps/">移动端</a>
                    
                      <a class="hover-with-bg" href="/tags/React/">React</a>
                    
                      <a class="hover-with-bg" href="/tags/ReactNative/">ReactNative</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本网所有内容文字和图片，版权均属谢小飞所有，任何媒体、网站或个人未经本网协议授权不得转载、链接、转贴或以其他方式复制发布/发表。如需转载请关注公众号【前端壹读】后回复【转载】。
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/11/15/FrontEnd-Sideline.html">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">聊一下最近做的副业项目</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/07/22/React-Native-Router.html">
                        <span class="hidden-mobile">深入学习React Native之路由导航</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createScript('https://xieyufei.com/npm/waline@1.6.0/Waline.min.js', function() {
        var options = Object.assign(
          {"serverURL":"https://comment.xieyufei.com","placeholder":"说点什么","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":true,"avatarCDN":"","avatarForce":false,"requiredFields":[],"emojiCDN":null,"emojiMaps":null,"anonymous":null,"appId":"dUHCmA1MmCKBNcTMG9KBopvL-MdYXbMMI","appKey":"33GvkVfTefXyelQRBTXNgEn6"},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        new Waline(options);
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="javascript:; target="_blank" rel="nofollow noopener"><span>We</span></a> <i class="iconfont icon-love"></i> <a href="https://xieyufei.com" target="_blank" rel="nofollow noopener"><span>谢小飞</span></a> <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  

  
  <!-- 备案信息 -->
  <div class="beian">
    <span>
      <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
        苏ICP备2024128889号-1
      </a>
    </span>
    
  </div>


  
    <!-- cnzz Analytics Icon -->
    <span id="cnzz_stat_icon_1260607518" style="display: none"></span>
  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://xieyufei.com/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://xieyufei.com/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://xieyufei.com/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://xieyufei.com/npm/bootstrap/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://xieyufei.com/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://xieyufei.com/npm/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://xieyufei.com/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://xieyufei.com/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>






  <script  src="https://xieyufei.com/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?466240fe55764d8ee20bd7f43c5e8b26";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  
    <!-- cnzz Analytics -->
    <script defer src="//s4.cnzz.com/z_stat.php?id=1260607518&show=pic"
            type="text/javascript"></script>
  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
